<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><div id="myscoll"></div><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><title>使用机器学习算法预测中国老年人的认知障碍并识别可改变的因素阅读 | 大鸟来啦✈️~</title><meta name="keywords" content="大鸟,博客"><meta name="author" content="本大鸟就是玩✈️~"><meta name="copyright" content="本大鸟就是玩✈️~"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="原文链接 原文 部分开源代码 数据集介绍 复现 from CLHLS.get_3year_data import get_period_data中的CLHLS代表文件夹后的.参考 用python处理时要把.sav转为.csv文件：法一：用spss导出不过发现导出的文件不太符合规则,选择utf-8，但是输出结果与作者的一致，因此应该没有问题。 法二：用R中的模块 12library(foreign)"><meta property="og:type" content="article"><meta property="og:title" content="使用机器学习算法预测中国老年人的认知障碍并识别可改变的因素阅读"><meta property="og:url" content="https://www.hgez6.top/posts/bb223095/index.html"><meta property="og:site_name" content="大鸟来啦✈️~"><meta property="og:description" content="原文链接 原文 部分开源代码 数据集介绍 复现 from CLHLS.get_3year_data import get_period_data中的CLHLS代表文件夹后的.参考 用python处理时要把.sav转为.csv文件：法一：用spss导出不过发现导出的文件不太符合规则,选择utf-8，但是输出结果与作者的一致，因此应该没有问题。 法二：用R中的模块 12library(foreign)"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://yun.hgez6.top/api/raw/?path=/picbed/9.jpg"><meta property="article:published_time" content="2023-11-15T13:33:46.000Z"><meta property="article:modified_time" content="2024-01-22T06:27:37.681Z"><meta property="article:author" content="本大鸟就是玩✈️~"><meta property="article:tag" content="大鸟,博客"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://yun.hgez6.top/api/raw/?path=/picbed/9.jpg"><link rel="shortcut icon" href="/"><link rel="canonical" href="https://www.hgez6.top/posts/bb223095/"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//hm.baidu.com"><link rel="preconnect" href="//busuanzi.ibruce.info"><meta name="baidu-site-verification" content="code-pgxsym62GU"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/font-awesome/6.0.0/css/all.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.staticfile.org/fancyapps-ui/4.0.31/fancybox.min.css" media="print" onload='this.media="all"'><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?530e82ef2951b6eb3701161fed246350";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><script>const GLOBAL_CONFIG={root:"/",algolia:void 0,localSearch:{path:"/search.xml",preload:!0,languages:{hits_empty:"找不到您查询的内容：${query}"}},translate:void 0,noticeOutdate:{limitDay:365,position:"top",messagePrev:"It has been",messageNext:"距离上一次更新文章已经太久请酌情阅读"},highlight:{plugin:"highlighjs",highlightCopy:!0,highlightLang:!0,highlightHeightLimit:230},copy:{success:"复制成功",error:"复制错误",noSupport:"浏览器不支持"},relativeDate:{homepage:!0,post:!0},runtime:"天",date_suffix:{just:"刚刚",min:"分钟前",hour:"小时前",day:"天前",month:"个月前"},copyright:void 0,lightbox:"fancybox",Snackbar:void 0,source:{justifiedGallery:{js:"/pluginsSrc/flickr-justified-gallery/dist/fjGallery.min.js",css:"/pluginsSrc/flickr-justified-gallery/dist/fjGallery.css"}},isPhotoFigcaption:!0,islazyload:!0,isAnchor:!0}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={title:"使用机器学习算法预测中国老年人的认知障碍并识别可改变的因素阅读",isPost:!0,isHome:!1,isHighlightShrink:!1,isToc:!0,postUpdate:"2024-01-22 14:27:37"}</script><noscript><style>#nav{opacity:1}.justified-gallery img{opacity:1}#post-meta time,#recent-posts time{display:inline!important}</style></noscript><script>(e=>{e.saveToLocal={set:function(e,t,o){if(0===o)return;const a=864e5*o,n={value:t,expiry:(new Date).getTime()+a};localStorage.setItem(e,JSON.stringify(n))},get:function(e){const t=localStorage.getItem(e);if(!t)return;const o=JSON.parse(t);if(!((new Date).getTime()>o.expiry))return o.value;localStorage.removeItem(e)}},e.getScript=e=>new Promise(((t,o)=>{const a=document.createElement("script");a.src=e,a.async=!0,a.onerror=o,a.onload=a.onreadystatechange=function(){const e=this.readyState;e&&"loaded"!==e&&"complete"!==e||(a.onload=a.onreadystatechange=null,t())},document.head.appendChild(a)})),e.activateDarkMode=function(){document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#0d0d0d")},e.activateLightMode=function(){document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","ffffff")};const t=saveToLocal.get("theme"),o=(new Date).getHours();void 0===t?o<=6||o>=18?activateDarkMode():activateLightMode():"light"===t?activateLightMode():activateDarkMode();const a=saveToLocal.get("aside-status");void 0!==a&&("hide"===a?document.documentElement.classList.add("hide-aside"):document.documentElement.classList.remove("hide-aside"));/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)&&document.documentElement.classList.add("apple")})(window)</script><link rel="stylesheet" href="https://cdn1.tianli0.top/npm/element-ui@2.15.6/packages/theme-chalk/lib/index.css"><link rel="stylesheet" href="/css/diycustom.css"><style id="themeColor"></style><style id="rightSide"></style><style id="transPercent"></style><style id="blurNum"></style><style id="settingStyle"></style><span id="fps"></span><style id="defineBg"></style><style id="menu_shadow"></style><canvas id="bubble"></canvas><link rel="stylesheet" href="/css/diybolang.css"><script src="/js/SAO-Notify.js" async></script><svg aria-hidden="true" style="position:absolute;overflow:hidden;width:0;height:0"><symbol id="icon-sun" viewBox="0 0 1024 1024"><path d="M960 512l-128 128v192h-192l-128 128-128-128H192v-192l-128-128 128-128V192h192l128-128 128 128h192v192z" fill="#FFD878" p-id="8420"></path><path d="M736 512a224 224 0 1 0-448 0 224 224 0 1 0 448 0z" fill="#FFE4A9" p-id="8421"></path><path d="M512 109.248 626.752 224H800v173.248L914.752 512 800 626.752V800h-173.248L512 914.752 397.248 800H224v-173.248L109.248 512 224 397.248V224h173.248L512 109.248M512 64l-128 128H192v192l-128 128 128 128v192h192l128 128 128-128h192v-192l128-128-128-128V192h-192l-128-128z" fill="#4D5152" p-id="8422"></path><path d="M512 320c105.888 0 192 86.112 192 192s-86.112 192-192 192-192-86.112-192-192 86.112-192 192-192m0-32a224 224 0 1 0 0 448 224 224 0 0 0 0-448z" fill="#4D5152" p-id="8423"></path></symbol><symbol id="icon-moon" viewBox="0 0 1024 1024"><path d="M611.370667 167.082667a445.013333 445.013333 0 0 1-38.4 161.834666 477.824 477.824 0 0 1-244.736 244.394667 445.141333 445.141333 0 0 1-161.109334 38.058667 85.077333 85.077333 0 0 0-65.066666 135.722666A462.08 462.08 0 1 0 747.093333 102.058667a85.077333 85.077333 0 0 0-135.722666 65.024z" fill="#FFB531" p-id="11345"></path><path d="M329.728 274.133333l35.157333-35.157333a21.333333 21.333333 0 1 0-30.165333-30.165333l-35.157333 35.157333-35.114667-35.157333a21.333333 21.333333 0 0 0-30.165333 30.165333l35.114666 35.157333-35.114666 35.157334a21.333333 21.333333 0 1 0 30.165333 30.165333l35.114667-35.157333 35.157333 35.157333a21.333333 21.333333 0 1 0 30.165333-30.165333z" fill="#030835" p-id="11346"></path></symbol></svg><link rel="stylesheet" href="/css/chajian/swiper.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="/css/chajian/swiperstyle.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="/css/chajian/animate.min.css" media="print" onload='this.media="screen"'><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-filter-gitcalendar/lib/gitcalendar.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="/css/chajian/font-awesome-animation.min.css" media="defer" onload='this.media="all"'><link rel="stylesheet" href="/css/chajian/tag_plugins.css" media="defer" onload='this.media="all"'><script src="/js/chajian/carousel-touch.js"></script><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="大鸟来啦✈️~" type="application/atom+xml"><link href="https://cdn.bootcss.com/KaTeX/0.11.1/katex.min.css" rel="stylesheet"></head><body><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><div class="loading-img"></div><div class="loading-image-dot"></div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://yun.hgez6.top/api/raw/?path=/picbed/tx.png" onerror='onerror=null,src="/assets/r1.jpg"' alt="avatar"></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">122</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">52</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">34</div></a></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-home"></use></svg> <span class="menu_word" style="font-size:17px">首页</span></a></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon--article"></use></svg> <span class="menu_word" style="font-size:17px">文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-guidang1"></use></svg> <span class="menu_word" style="font-size:17px">时间轴</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-sekuaibiaoqian"></use></svg> <span class="menu_word" style="font-size:17px">标签</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-fenlei"></use></svg> <span class="menu_word" style="font-size:17px">分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:randomPost();"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-suiji"></use></svg> <span class="menu_word" style="font-size:17px">随便看看</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-pinweishenghuo"></use></svg> <span class="menu_word" style="font-size:17px">休闲</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-yinle"></use></svg> <span class="menu_word" style="font-size:17px">音乐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/Bmovies/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-dianying1"></use></svg> <span class="menu_word" style="font-size:17px">视频</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/mypicture/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-xiangce"></use></svg> <span class="menu_word" style="font-size:17px">图库</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-niao"></use></svg> <span class="menu_word" style="font-size:17px">日常</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/movies/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-dianying"></use></svg> <span class="menu_word" style="font-size:17px">观影</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/books/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-shu"></use></svg> <span class="menu_word" style="font-size:17px">看书</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/games/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-youxi"></use></svg> <span class="menu_word" style="font-size:17px">游戏</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-xiangzi"></use></svg> <span class="menu_word" style="font-size:17px">八宝箱</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/zm/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-yun"></use></svg> <span class="menu_word" style="font-size:17px">云电脑</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/guidehg/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-jingzi"></use></svg> <span class="menu_word" style="font-size:17px">引导页</span></a></li><li><a class="site-page child faa-parent animated-hover" target="_blank" rel="noopener" href="https://yun.hgez6.top/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-zuzhiheguanlitubiao-"></use></svg> <span class="menu_word" style="font-size:17px">云空间</span></a></li><li><a class="site-page child faa-parent animated-hover" target="_blank" rel="noopener" href="https://e5.hgez6.top/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-wuxian"></use></svg> <span class="menu_word" style="font-size:17px">E5无限云</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/zjapi/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-APIjiekou"></use></svg> <span class="menu_word" style="font-size:17px">自建API</span></a></li><li><a class="site-page child faa-parent animated-hover" target="_blank" rel="noopener" href="https://gd.hgez6.top/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-qiehuan"></use></svg> <span class="menu_word" style="font-size:17px">切换主题</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/box/nav/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-zhifengche"></use></svg> <span class="menu_word" style="font-size:17px">网址导航</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-shejiaoxinxi"></use></svg> <span class="menu_word" style="font-size:17px">社交</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/social/fcircle/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-pengyouquan"></use></svg> <span class="menu_word" style="font-size:17px">朋友圈</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-liuyan"></use></svg> <span class="menu_word" style="font-size:17px">留言板</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/social/link/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-lianjie"></use></svg> <span class="menu_word" style="font-size:17px">友人帐</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-wangye"></use></svg> <span class="menu_word" style="font-size:17px">网站</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" target="_blank" rel="noopener" href="https://status.hgez6.top/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-jiancefanwei"></use></svg> <span class="menu_word" style="font-size:17px">状态监测</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/site/census/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon--tongjibiao"></use></svg> <span class="menu_word" style="font-size:17px">网站统计</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/charts/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-shujutongji1"></use></svg> <span class="menu_word" style="font-size:17px">文章统计</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/aboutweb/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-guanyuwomen"></use></svg> <span class="menu_word" style="font-size:17px">关于本站</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-maoliang"></use></svg> <span class="menu_word" style="font-size:17px">个人</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/personal/bb/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-qunliaotian"></use></svg> <span class="menu_word" style="font-size:17px">唠叨</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/personal/love/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-love-sign"></use></svg> <span class="menu_word" style="font-size:17px">恋爱小屋</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/about/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-paperplane"></use></svg> <span class="menu_word" style="font-size:17px">关于</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">大鸟来啦✈️~</a></span><div id="he-plugin-simple"></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-home"></use></svg> <span class="menu_word" style="font-size:17px">首页</span></a></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon--article"></use></svg> <span class="menu_word" style="font-size:17px">文章</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-guidang1"></use></svg> <span class="menu_word" style="font-size:17px">时间轴</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-sekuaibiaoqian"></use></svg> <span class="menu_word" style="font-size:17px">标签</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-fenlei"></use></svg> <span class="menu_word" style="font-size:17px">分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:randomPost();"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-suiji"></use></svg> <span class="menu_word" style="font-size:17px">随便看看</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-pinweishenghuo"></use></svg> <span class="menu_word" style="font-size:17px">休闲</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-yinle"></use></svg> <span class="menu_word" style="font-size:17px">音乐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/Bmovies/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-dianying1"></use></svg> <span class="menu_word" style="font-size:17px">视频</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/mypicture/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-xiangce"></use></svg> <span class="menu_word" style="font-size:17px">图库</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-niao"></use></svg> <span class="menu_word" style="font-size:17px">日常</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/movies/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-dianying"></use></svg> <span class="menu_word" style="font-size:17px">观影</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/books/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-shu"></use></svg> <span class="menu_word" style="font-size:17px">看书</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/games/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-youxi"></use></svg> <span class="menu_word" style="font-size:17px">游戏</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-xiangzi"></use></svg> <span class="menu_word" style="font-size:17px">八宝箱</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/zm/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-yun"></use></svg> <span class="menu_word" style="font-size:17px">云电脑</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/guidehg/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-jingzi"></use></svg> <span class="menu_word" style="font-size:17px">引导页</span></a></li><li><a class="site-page child faa-parent animated-hover" target="_blank" rel="noopener" href="https://yun.hgez6.top/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-zuzhiheguanlitubiao-"></use></svg> <span class="menu_word" style="font-size:17px">云空间</span></a></li><li><a class="site-page child faa-parent animated-hover" target="_blank" rel="noopener" href="https://e5.hgez6.top/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-wuxian"></use></svg> <span class="menu_word" style="font-size:17px">E5无限云</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/zjapi/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-APIjiekou"></use></svg> <span class="menu_word" style="font-size:17px">自建API</span></a></li><li><a class="site-page child faa-parent animated-hover" target="_blank" rel="noopener" href="https://gd.hgez6.top/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-qiehuan"></use></svg> <span class="menu_word" style="font-size:17px">切换主题</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/box/nav/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-zhifengche"></use></svg> <span class="menu_word" style="font-size:17px">网址导航</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-shejiaoxinxi"></use></svg> <span class="menu_word" style="font-size:17px">社交</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/social/fcircle/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-pengyouquan"></use></svg> <span class="menu_word" style="font-size:17px">朋友圈</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-liuyan"></use></svg> <span class="menu_word" style="font-size:17px">留言板</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/social/link/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-lianjie"></use></svg> <span class="menu_word" style="font-size:17px">友人帐</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-wangye"></use></svg> <span class="menu_word" style="font-size:17px">网站</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" target="_blank" rel="noopener" href="https://status.hgez6.top/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-jiancefanwei"></use></svg> <span class="menu_word" style="font-size:17px">状态监测</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/site/census/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon--tongjibiao"></use></svg> <span class="menu_word" style="font-size:17px">网站统计</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/charts/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-shujutongji1"></use></svg> <span class="menu_word" style="font-size:17px">文章统计</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/aboutweb/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-guanyuwomen"></use></svg> <span class="menu_word" style="font-size:17px">关于本站</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-maoliang"></use></svg> <span class="menu_word" style="font-size:17px">个人</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/personal/bb/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-qunliaotian"></use></svg> <span class="menu_word" style="font-size:17px">唠叨</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/personal/love/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-love-sign"></use></svg> <span class="menu_word" style="font-size:17px">恋爱小屋</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/about/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.3em;height:1.3em;vertical-align:-.15em;fill:currentColor;overflow:hidden"><use xlink:href="#icon-paperplane"></use></svg> <span class="menu_word" style="font-size:17px">关于</span></a></li></ul></div></div><center id="name-container"><a id="page-name" href="javascript:scrollToTop()">PAGE_NAME</a></center><div id="nav-right"><div id="search-button"><a class="search faa-parent animated-hover" title="检索站内任何你想要的信息"><svg class="faa-tada icon" style="height:24px;width:24px;fill:currentColor;position:relative;top:6px" aria-hidden="true"><use xlink:href="#icon-valentine_-search-love-find-heart"></use></svg> <span>搜索</span></a></div><a class="meihua faa-parent animated-hover" onclick="toggleWinbox()" title="美化设置-自定义你的风格" id="meihua-button"><svg class="faa-tada icon" style="height:26px;width:26px;fill:currentColor;position:relative;top:8px" aria-hidden="true"><use xlink:href="#icon-tupian1"></use></svg></a><a class="sun_moon faa-parent animated-hover" onclick="switchNightMode()" title="浅色和深色模式转换" id="nightmode-button"><svg class="faa-tada" style="height:25px;width:25px;fill:currentColor;position:relative;top:7px" viewBox="0 0 1024 1024"><use id="modeicon" xlink:href="#icon-moon"></use></svg></a><div id="toggle-menu"><a><i class="fas fa-bars fa-fw"></i></a></div></div></div></nav><div id="post-info"><h1 class="post-title">使用机器学习算法预测中国老年人的认知障碍并识别可改变的因素阅读</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><svg class="meta_icon post-meta-icon" style="width:30px;height:30px;position:relative;top:10px"><use xlink:href="#icon-rili"></use></svg><span class="post-meta-label">发表于</span> <time class="post-meta-date-created" datetime="2023-11-15T13:33:46.000Z" title="发表于 2023-11-15 21:33:46">2023-11-15</time><span class="post-meta-separator">|</span><svg class="meta_icon post-meta-icon" style="width:18px;height:18px;position:relative;top:5px"><use xlink:href="#icon-gengxin1"></use></svg><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-01-22T06:27:37.681Z" title="更新于 2024-01-22 14:27:37">2024-01-22</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><svg class="meta_icon post-meta-icon" style="width:25px;height:25px;position:relative;top:8px"><use xlink:href="#icon-charuword"></use></svg><span class="post-meta-label">字数总计:</span><span class="word-count">8498</span><span class="post-meta-separator">|</span><svg class="meta_icon post-meta-icon" style="width:20px;height:20px;position:relative;top:5px"><use xlink:href="#icon-shizhong"></use></svg><span class="post-meta-label">阅读时长:</span><span>42分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" data-flag-title="使用机器学习算法预测中国老年人的认知障碍并识别可改变的因素阅读"><svg class="meta_icon post-meta-icon" style="width:25px;height:25px;position:relative;top:5px"><use xlink:href="#icon-eye"></use></svg><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s58 18 88 18 58-18 88-18 58 18 88 18v44h-352Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="原文链接">原文链接</h1><p><a target="_blank" rel="noopener" href="https://www.frontiersin.org/articles/10.3389/fnagi.2022.977034/full">原文</a><br><a target="_blank" rel="noopener" href="https://github.com/Weiren-Wang/CLHLS_Coginitive_Impairment/tree/main">部分开源代码</a><br><a target="_blank" rel="noopener" href="http://chads.nsd.pku.edu.cn/sjzx/tcsj/508264.htm">数据集介绍</a></p><h2 id="复现">复现</h2><p><code>from CLHLS.get_3year_data import get_period_data</code>中的CLHLS代表文件夹后的.<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_44305115/article/details/115297325">参考</a><br>用python处理时要把.sav转为.csv文件：法一：用spss导出不过发现导出的文件不太符合规则,选择utf-8，但是输出结果与作者的一致，因此应该没有问题。<br>法二：用R中的模块</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">library<span class="punctuation">(</span>foreign<span class="punctuation">)</span></span><br><span class="line">write.table<span class="punctuation">(</span>read.spss<span class="punctuation">(</span><span class="string">&quot;inFile.sav&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> file<span class="operator">=</span><span class="string">&quot;outFile.csv&quot;</span><span class="punctuation">,</span> <span class="built_in">quote</span> <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span> sep <span class="operator">=</span> <span class="string">&quot;,&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure><p>文件Descriptive Data.ipynb用于数据预处理。<br><a target="_blank" rel="noopener" href="https://www.runoob.com/python/python-func-enumerate.html">Python enumerate() 函数</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_44852067/article/details/122238481">.columns属性以返回给定 DataFrame 的列标签</a><br>csv文件形式和sav一样所以直接用sav看更直观，csv只是处理数据比较方便，变量视图可以看到问过的问题和答案，变量_5代表随访到2005年时做过的调查<br>这些数据虽然有些是02到18有些是05到18，但是应该调查人群不同<br>.key()可以获得字典中所有的键，而不是键值。<br>语法dictionary.keys()<br>使用示例&gt;&gt;&gt; list({'Chinasoft':'China', 'Microsoft':'USA'}.keys())<br>['Chinasoft', 'Microsoft']<br>在pandas中，value_counts常用于数据表的计数及排序，它可以用来查看数据表中，指定列里有多少个不同的数据值，并计算每个不同值有在该列中的个数，同时还能根据需要进行排序<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/113342292">参考</a>。<br><a target="_blank" rel="noopener" href="https://www.runoob.com/python/python-lists.html">列表(List)</a><br><a target="_blank" rel="noopener" href="https://www.runoob.com/python/python-func-map.html">函数map() 会根据提供的函数对指定序列做映射。第一个参数 function 以参数序列中的每一个元素调用 function 函数，返回包含每次 function 函数返回值的新列表。</a><br>以下代码段的解释：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 根据需要用到的变量名和三年后的后缀 得到 需要用到的三年后的变量名</span></span><br><span class="line"><span class="comment">## 11年前，后续年份随访调查的年龄字段叫vage_年份； 11年后，后续年份随访调查的年龄字段叫trueage_年份；</span></span><br><span class="line"><span class="keyword">if</span> start_year != <span class="number">2011</span>:</span><br><span class="line">    three_years_later_columns = <span class="built_in">list</span>(</span><br><span class="line">        <span class="built_in">map</span>(<span class="keyword">lambda</span> x: x + year_index <span class="keyword">if</span> x != <span class="string">&#x27;trueage&#x27;</span> <span class="keyword">else</span> <span class="string">&#x27;vage&#x27;</span> + year_index, basic_columns))</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    three_years_later_columns = <span class="built_in">list</span>(<span class="built_in">map</span>(<span class="keyword">lambda</span> x: x + year_index, basic_columns))</span><br></pre></td></tr></table></figure><p>这个操作的作用就是获得三年后随访的变量名，11年前，后续年份随访调查的年龄字段叫vage_年份； 11年后，后续年份随访调查的年龄字段叫trueage_年份，这里的x取值和<code>if start_year != 2011:</code>这句话有关<br>因为个人信息问题只在初始年记录，后续年没有，把三年后的个人信息问题去掉留下三年后的问题信息，然后把起始年的信息加上，代码如下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 个人信息问题只在初始年记录，后续年没有，把三年后的个人信息问题去掉</span></span><br><span class="line">    <span class="keyword">for</span> personal_stable_variable <span class="keyword">in</span> <span class="built_in">list</span>(<span class="built_in">map</span>(<span class="keyword">lambda</span> x: x + year_index, [<span class="string">&#x27;a2&#x27;</span>, <span class="string">&#x27;f1&#x27;</span>, <span class="string">&#x27;a1&#x27;</span>, <span class="string">&#x27;a41&#x27;</span>, <span class="string">&#x27;a43&#x27;</span>])):</span><br><span class="line">        three_years_later_columns.remove(personal_stable_variable)</span><br><span class="line"><span class="comment">#总共的信息把三年后的个人信息问题去掉留下三年后的问题信息，然后把起始年的信息加上</span></span><br><span class="line">    total_columns = basic_columns + three_years_later_columns</span><br></pre></td></tr></table></figure><p>筛选3年后随访还活着且没失访的老年人，比如dth11_14代表11年开始调查到14年还有是否活着0代表14年还存活<br>下面的代码用于处理有缺失值的问卷变量：<br>因为问卷中8代表缺失值，而其中一些变量值可取8因此先进行分类讨论：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 以下问题的问卷选项中存在官方的取值8，或者有可能出现取值8。所以不能将这些变量的8作为缺失处理</span></span><br><span class="line">questions_may_contain8 = [<span class="string">&#x27;vage&#x27;</span>, <span class="string">&#x27;trueage&#x27;</span>, <span class="string">&#x27;a2&#x27;</span>, <span class="string">&#x27;a41&#x27;</span>, <span class="string">&#x27;f1&#x27;</span>, <span class="string">&#x27;b21&#x27;</span>, <span class="string">&#x27;b22&#x27;</span>, <span class="string">&#x27;b23&#x27;</span>, <span class="string">&#x27;b24&#x27;</span>, <span class="string">&#x27;b25&#x27;</span>, <span class="string">&#x27;b26&#x27;</span>, <span class="string">&#x27;b27&#x27;</span>,</span><br><span class="line">                          <span class="string">&#x27;d75&#x27;</span>, <span class="string">&#x27;d86&#x27;</span>, <span class="string">&#x27;d12&#x27;</span>, <span class="string">&#x27;c11&#x27;</span>, <span class="string">&#x27;c12&#x27;</span>, <span class="string">&#x27;c13&#x27;</span>, <span class="string">&#x27;c14&#x27;</span>, <span class="string">&#x27;c15&#x27;</span>, <span class="string">&#x27;c16&#x27;</span>, <span class="string">&#x27;c21a&#x27;</span>, <span class="string">&#x27;c21b&#x27;</span>, <span class="string">&#x27;c21c&#x27;</span>,</span><br><span class="line">                          <span class="string">&#x27;c31a&#x27;</span>, <span class="string">&#x27;c31b&#x27;</span>, <span class="string">&#x27;c31c&#x27;</span>, <span class="string">&#x27;c31d&#x27;</span>, <span class="string">&#x27;c31e&#x27;</span>, <span class="string">&#x27;c32&#x27;</span>, <span class="string">&#x27;c41a&#x27;</span>, <span class="string">&#x27;c41b&#x27;</span>, <span class="string">&#x27;c41c&#x27;</span>, <span class="string">&#x27;c51a&#x27;</span>, <span class="string">&#x27;c51b&#x27;</span>,</span><br><span class="line">                          <span class="string">&#x27;c52&#x27;</span>, <span class="string">&#x27;c53a&#x27;</span>, <span class="string">&#x27;c53b&#x27;</span>, <span class="string">&#x27;c53c&#x27;</span>]</span><br><span class="line">year_index = <span class="string">&#x27;_&#x27;</span> + <span class="built_in">str</span>(start_year + <span class="number">3</span>)[-<span class="number">1</span>] <span class="keyword">if</span> start_year + <span class="number">3</span> &lt; <span class="number">2010</span> <span class="keyword">else</span> <span class="string">&#x27;_&#x27;</span> + <span class="built_in">str</span>(start_year + <span class="number">3</span>)[-<span class="number">2</span>:]</span><br><span class="line">later_questions_may_contain8 = <span class="built_in">list</span>(<span class="built_in">map</span>(<span class="keyword">lambda</span> x: x + year_index, questions_may_contain8))</span><br><span class="line">total_questions_may_contain8 = questions_may_contain8 + later_questions_may_contain8</span><br></pre></td></tr></table></figure><p>而剩余变量含8的可能会是缺失值,<a target="_blank" rel="noopener" href="https://www.cnblogs.com/dataAnalysis/p/9353245.html">replace函数</a>，这段代码把由数字代表的缺失值用NAN描述了。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 把剩下的变量中的按codebook说明的缺失取值或不合理取值变成缺失值。</span></span><br><span class="line">    variable_needed_processed = <span class="built_in">list</span>(<span class="built_in">set</span>(df.columns) - <span class="built_in">set</span>(total_questions_may_contain8))</span><br><span class="line">    new_df = df.copy()</span><br><span class="line">    <span class="keyword">for</span> var <span class="keyword">in</span> variable_needed_processed:</span><br><span class="line">        new_df[var] = new_df[var].replace(<span class="number">8</span>, np.nan)</span><br><span class="line">        new_df[var] = new_df[var].replace(<span class="number">88</span>, np.nan)</span><br><span class="line">        new_df[var] = new_df[var].replace(<span class="number">888</span>, np.nan)</span><br><span class="line">        new_df[var] = new_df[var].replace(<span class="number">8888</span>, np.nan)</span><br><span class="line">        new_df[var] = new_df[var].replace(<span class="number">9</span>, np.nan)</span><br><span class="line">        new_df[var] = new_df[var].replace(<span class="number">99</span>, np.nan)</span><br><span class="line">        new_df[var] = new_df[var].replace(<span class="number">99</span>, np.nan)</span><br><span class="line">        new_df[var] = new_df[var].replace(<span class="number">9999</span>, np.nan)</span><br></pre></td></tr></table></figure><p>下面代码似乎在计算各个变量中缺失的概率,<a target="_blank" rel="noopener" href="https://blog.csdn.net/Mr_HHH/article/details/79488517">df.isnull()</a>,df.isnull().any()则会判断哪些”列”存在缺失值,new_df.loc[:, new_df.isnull().any()].isnull().sum()就是把所有有缺失值的列累加，最后除以总数，就是缺失的概率。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Missing values situation&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(</span><br><span class="line">        (new_df.loc[:, new_df.isnull().<span class="built_in">any</span>()].isnull().<span class="built_in">sum</span>() / <span class="built_in">len</span>(df)).apply(<span class="keyword">lambda</span> x: <span class="built_in">str</span>(<span class="string">&#x27;%.2f&#x27;</span> % (x * <span class="number">100</span>)) + <span class="string">&#x27;%&#x27;</span>))</span><br><span class="line"><span class="comment"># 用众数填补变量的缺失值这个待会打下断点</span></span><br><span class="line">    <span class="keyword">for</span> col <span class="keyword">in</span> new_df.columns[new_df.isnull().<span class="built_in">any</span>()]:</span><br><span class="line">        mode = new_df[col].value_counts().sort_values(ascending=<span class="literal">False</span>).index[<span class="number">0</span>]</span><br><span class="line">        new_df[col].fillna(mode, inplace=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><p>去掉MMSE问题全部不能回答【总共23个问题】的人员，也就是删掉一些行数，<code>new_df = new_df[new_df.isnull().sum(axis=1) &lt; 23]</code>代表有任何一个问题能回答就保留，最后该段代码统计减去未统计MMSE的人数</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 去掉MMSE问题全部不能回答的</span></span><br><span class="line">MMSE_questions = [<span class="string">&#x27;c11&#x27;</span>, <span class="string">&#x27;c12&#x27;</span>, <span class="string">&#x27;c13&#x27;</span>, <span class="string">&#x27;c14&#x27;</span>, <span class="string">&#x27;c15&#x27;</span>, <span class="string">&#x27;c21a&#x27;</span>, <span class="string">&#x27;c21b&#x27;</span>, <span class="string">&#x27;c21c&#x27;</span>, <span class="string">&#x27;c31a&#x27;</span>, <span class="string">&#x27;c31b&#x27;</span>, <span class="string">&#x27;c31c&#x27;</span>, <span class="string">&#x27;c31d&#x27;</span>, <span class="string">&#x27;c31e&#x27;</span>,</span><br><span class="line">                  <span class="string">&#x27;c32&#x27;</span>, <span class="string">&#x27;c41a&#x27;</span>, <span class="string">&#x27;c41b&#x27;</span>, <span class="string">&#x27;c41c&#x27;</span>, <span class="string">&#x27;c51a&#x27;</span>, <span class="string">&#x27;c51b&#x27;</span>, <span class="string">&#x27;c52&#x27;</span>, <span class="string">&#x27;c53a&#x27;</span>, <span class="string">&#x27;c53b&#x27;</span>, <span class="string">&#x27;c53c&#x27;</span>]</span><br><span class="line">MMSE_questions_later = <span class="built_in">list</span>(<span class="built_in">map</span>(<span class="keyword">lambda</span> x: x + year_index, MMSE_questions))</span><br><span class="line"><span class="keyword">for</span> var <span class="keyword">in</span> MMSE_questions:</span><br><span class="line">    new_df[var] = new_df[var].replace(<span class="number">8</span>, np.nan)</span><br><span class="line">    new_df[var] = new_df[var].replace(<span class="number">88</span>, np.nan)</span><br><span class="line">    new_df[var] = new_df[var].replace(<span class="number">888</span>, np.nan)</span><br><span class="line">    new_df[var] = new_df[var].replace(<span class="number">8888</span>, np.nan)</span><br><span class="line">    new_df[var] = new_df[var].replace(<span class="number">9</span>, np.nan)</span><br><span class="line">    new_df[var] = new_df[var].replace(<span class="number">99</span>, np.nan)</span><br><span class="line">    new_df[var] = new_df[var].replace(<span class="number">99</span>, np.nan)</span><br><span class="line">    new_df[var] = new_df[var].replace(<span class="number">9999</span>, np.nan)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Samples before drop current MMSE missing : &#x27;</span>, <span class="built_in">len</span>(new_df))</span><br><span class="line">new_df = new_df[new_df.isnull().<span class="built_in">sum</span>(axis=<span class="number">1</span>) &lt; <span class="number">23</span>]</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Samples before drop current MMSE missing : &#x27;</span>, <span class="built_in">len</span>(new_df))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> var <span class="keyword">in</span> MMSE_questions_later:</span><br><span class="line">    new_df[var] = new_df[var].replace(<span class="number">8</span>, np.nan)</span><br><span class="line">    new_df[var] = new_df[var].replace(<span class="number">88</span>, np.nan)</span><br><span class="line">    new_df[var] = new_df[var].replace(<span class="number">888</span>, np.nan)</span><br><span class="line">    new_df[var] = new_df[var].replace(<span class="number">8888</span>, np.nan)</span><br><span class="line">    new_df[var] = new_df[var].replace(<span class="number">9</span>, np.nan)</span><br><span class="line">    new_df[var] = new_df[var].replace(<span class="number">99</span>, np.nan)</span><br><span class="line">    new_df[var] = new_df[var].replace(<span class="number">99</span>, np.nan)</span><br><span class="line">    new_df[var] = new_df[var].replace(<span class="number">9999</span>, np.nan)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Samples before drop later MMSE missing : &#x27;</span>, <span class="built_in">len</span>(new_df))</span><br><span class="line">new_df = new_df[new_df.isnull().<span class="built_in">sum</span>(axis=<span class="number">1</span>) &lt; <span class="number">23</span>]</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Samples before drop later MMSE missing : &#x27;</span>, <span class="built_in">len</span>(new_df))</span><br></pre></td></tr></table></figure><p>统计大于60岁的人数，并于之前对比。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Before drop age&lt;60 : &#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Wave 1: &#x27;</span>,<span class="built_in">len</span>(first_wave_new))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Wave 2: &#x27;</span>,<span class="built_in">len</span>(second_wave_new))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Wave 3: &#x27;</span>,<span class="built_in">len</span>(third_wave_new))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Wave 4: &#x27;</span>,<span class="built_in">len</span>(fourth_wave_new))</span><br><span class="line">first_wave_new = first_wave_new[first_wave_new.trueage&gt;=<span class="number">60</span>]</span><br><span class="line">second_wave_new = second_wave_new[second_wave_new.trueage&gt;=<span class="number">60</span>]</span><br><span class="line">third_wave_new = third_wave_new[third_wave_new.trueage&gt;=<span class="number">60</span>]</span><br><span class="line">fourth_wave_new = fourth_wave_new[fourth_wave_new.trueage&gt;=<span class="number">60</span>]</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;After drop age&lt;60 : &#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Wave 1: &#x27;</span>,<span class="built_in">len</span>(first_wave_new))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Wave 2: &#x27;</span>,<span class="built_in">len</span>(second_wave_new))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Wave 3: &#x27;</span>,<span class="built_in">len</span>(third_wave_new))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Wave 4: &#x27;</span>,<span class="built_in">len</span>(fourth_wave_new))</span><br></pre></td></tr></table></figure><h3 id="数据预处理总述">数据预处理总述</h3><p>数据处理阶段一，纳入了 2002 年至 2014 年间的 4 波非重叠的 3 年调查数据，和所需的各个列变量【调查变量】，我们首先纳入了 2002 年至 2014 年间的 4 波非重叠的 3 年调查数据。参与者选择的详细流程图如图 1 所示。所有参与者每 3 年接受一次随访（一波）。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_data_between_start_to_end</span>(<span class="params">df,start_year</span>):</span><br><span class="line">    <span class="comment"># 根据输入df的起始年份得到三年后的变量后缀，如输入2002年的df，则三年后的变量后缀为 _5，输入2011年的，三年后变量后缀则为_14</span></span><br><span class="line">    <span class="comment"># 使用str()函数 转换为字符串使其可以使用下标索引访问</span></span><br><span class="line">    short_year = <span class="built_in">str</span>(start_year+<span class="number">3</span>)[-<span class="number">1</span>] <span class="keyword">if</span> start_year+<span class="number">3</span> &lt; <span class="number">2010</span> <span class="keyword">else</span> <span class="built_in">str</span>(start_year+<span class="number">3</span>)[-<span class="number">2</span>:]</span><br><span class="line">    variable_list = []</span><br><span class="line">    index = <span class="number">0</span></span><br><span class="line">    minux_index = <span class="built_in">len</span>(short_year)+<span class="number">1</span></span><br><span class="line">    <span class="comment"># 把起始年份的变量名称收集记起来，读取列标签名</span></span><br><span class="line">    <span class="comment"># 三年期的问卷变量</span></span><br><span class="line">    <span class="keyword">for</span> i,variable <span class="keyword">in</span> <span class="built_in">enumerate</span>(df.columns):</span><br><span class="line">        <span class="comment">#如果变量中包含截止年份信息</span></span><br><span class="line">        <span class="keyword">if</span> variable[-minux_index:] == <span class="string">&#x27;_&#x27;</span> + short_year:</span><br><span class="line">            index = i</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="comment">#这里的语句没有在if里面需要特别注意</span></span><br><span class="line">        variable_list.append(variable)</span><br><span class="line">    <span class="built_in">print</span>(index)</span><br><span class="line">     <span class="comment"># 把三年后的变量名称收集起来，每两次访问的变量之间都有一个&quot;dth年份_年份&quot;变量进行隔开&quot;dth年份_年份&quot;就相当于另一个周期，所以以该变量为分割提取，遇到该变量就停止</span></span><br><span class="line">    <span class="comment"># 当年的问卷变量</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(index,<span class="built_in">len</span>(df.columns)):</span><br><span class="line">        <span class="keyword">if</span> df.columns[j] == <span class="string">&#x27;dth&#x27;</span>+<span class="built_in">str</span>(start_year+<span class="number">3</span>)[-<span class="number">2</span>:]+<span class="string">&#x27;_&#x27;</span>+<span class="built_in">str</span>(start_year+<span class="number">6</span>)[-<span class="number">2</span>:] <span class="keyword">or</span> df.columns[j][-<span class="number">3</span>:] == <span class="string">&#x27;_&#x27;</span>+<span class="built_in">str</span>(start_year+<span class="number">7</span>)[-<span class="number">2</span>:]:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        variable_list.append(df.columns[j])</span><br><span class="line">    <span class="comment"># 根据变量名提取出当年，和三年期的问卷变量，其他年份的抛弃</span></span><br><span class="line">    <span class="built_in">print</span>(variable_list)</span><br><span class="line">    <span class="keyword">return</span> df.loc[:,variable_list]</span><br></pre></td></tr></table></figure><p>数据预处理和统计,根据变量dth02_05统计出三年间存活，死亡，失踪的各个项目人数</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">数据预处理和统计</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_df_peo_3years_situation</span>(<span class="params">data02to05,data05to08,data08to11,data11to14</span>):</span><br><span class="line">    <span class="comment">#错误数据预处理</span></span><br><span class="line">    <span class="comment"># data11to14里的dth11_14字段中有&#x27; &#x27;空格字符，所以该字段为字符串类型，需要将其改为数值型</span></span><br><span class="line">    data11to14.dth11_14 = pd.to_numeric(data11to14.dth11_14,errors = <span class="string">&#x27;coerce&#x27;</span>)</span><br><span class="line">    <span class="comment"># data08to11中有一位老年人的dth11_14字段中值为2011，经核对该老人为存活者，所以将其改为0</span></span><br><span class="line">    data08to11.loc[data08to11[data08to11.dth08_11 == <span class="number">2011</span>].index,<span class="string">&#x27;dth08_11&#x27;</span>] = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 整理各组数据的起始调查人数，三年存活人数，三年死亡人数，三年失访人数&#123;典型的无效数据&#125;</span></span><br><span class="line">    observations = []</span><br><span class="line">    survivor = []</span><br><span class="line">    death = []</span><br><span class="line">    missing = []</span><br><span class="line">    df_dict = &#123;<span class="string">&#x27;df1&#x27;</span>:data02to05,<span class="string">&#x27;df2&#x27;</span>:data05to08,<span class="string">&#x27;df3&#x27;</span>:data08to11,<span class="string">&#x27;df4&#x27;</span>:data11to14&#125;</span><br><span class="line">    df_var_dict = &#123;<span class="string">&#x27;df1&#x27;</span>:<span class="string">&#x27;dth02_05&#x27;</span>,<span class="string">&#x27;df2&#x27;</span>:<span class="string">&#x27;dth05_08&#x27;</span>,<span class="string">&#x27;df3&#x27;</span>:<span class="string">&#x27;dth08_11&#x27;</span>,<span class="string">&#x27;df4&#x27;</span>:<span class="string">&#x27;dth11_14&#x27;</span>&#125;</span><br><span class="line">    <span class="keyword">for</span> df <span class="keyword">in</span> df_dict.keys():</span><br><span class="line">        <span class="built_in">print</span>(df) <span class="comment">#df1 df2 df3 df4</span></span><br><span class="line">        <span class="built_in">print</span>(df_dict[df]) <span class="comment">#各个data02to05完整数组</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">len</span>(df_dict[df]))  <span class="comment"># 各个data02to05完整数组的行数就是总统计人数</span></span><br><span class="line">        counter = df_dict[df][df_var_dict[df]].value_counts()</span><br><span class="line">        observations.append(<span class="built_in">len</span>(df_dict[df]))</span><br><span class="line">        survivor.append(counter[<span class="number">0</span>])</span><br><span class="line">        death.append(counter[<span class="number">1</span>])</span><br><span class="line">        missing.append(counter[-<span class="number">9</span>])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> pd.DataFrame(&#123;<span class="string">&#x27;start year observations&#x27;</span>:observations,</span><br><span class="line">                     <span class="string">&#x27;survivor&#x27;</span>:survivor,</span><br><span class="line">                      <span class="string">&#x27;death&#x27;</span>:death,</span><br><span class="line">                      <span class="string">&#x27;missing&#x27;</span>:missing&#125;,index = [<span class="string">&#x27;2002 to 2005&#x27;</span>,<span class="string">&#x27;2005 to 2008&#x27;</span>,<span class="string">&#x27;2008 to 2011&#x27;</span>,<span class="string">&#x27;2011 to 2014&#x27;</span>])</span><br><span class="line"></span><br><span class="line">situation = get_df_peo_3years_situation(data02to05,data05to08,data08to11,data11to14)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Number of investgated elders situations : &#x27;</span>,<span class="string">&#x27;\n&#x27;</span>,situation)</span><br></pre></td></tr></table></figure><p>筛选出还活着的列表然后取特定的列变量，把三年后的初始个人信息问题去掉</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_wave_data</span>(<span class="params">df, start_year</span>):</span><br><span class="line">    <span class="comment"># 需要用到的变量名</span></span><br><span class="line">    basic_columns = [<span class="string">&#x27;a1&#x27;</span>, <span class="string">&#x27;trueage&#x27;</span>, <span class="string">&#x27;a2&#x27;</span>, <span class="string">&#x27;f1&#x27;</span>, <span class="string">&#x27;f41&#x27;</span>, <span class="string">&#x27;f34&#x27;</span>, <span class="string">&#x27;a41&#x27;</span>, <span class="string">&#x27;a43&#x27;</span>, <span class="string">&#x27;a51&#x27;</span>,  <span class="comment"># personal info</span></span><br><span class="line">                     <span class="string">&#x27;b21&#x27;</span>, <span class="string">&#x27;b22&#x27;</span>, <span class="string">&#x27;b23&#x27;</span>, <span class="string">&#x27;b24&#x27;</span>, <span class="string">&#x27;b25&#x27;</span>, <span class="string">&#x27;b26&#x27;</span>, <span class="string">&#x27;b27&#x27;</span>,  <span class="comment"># psychological status</span></span><br><span class="line">                     <span class="string">&#x27;d71&#x27;</span>, <span class="string">&#x27;d72&#x27;</span>, <span class="string">&#x27;d75&#x27;</span>, <span class="string">&#x27;d81&#x27;</span>, <span class="string">&#x27;d82&#x27;</span>, <span class="string">&#x27;d86&#x27;</span>, <span class="string">&#x27;d91&#x27;</span>, <span class="string">&#x27;d92&#x27;</span>, <span class="string">&#x27;d31&#x27;</span>, <span class="string">&#x27;d32&#x27;</span>,  <span class="comment"># living style</span></span><br><span class="line">                     <span class="string">&#x27;d11b&#x27;</span>, <span class="string">&#x27;d11c&#x27;</span>, <span class="string">&#x27;d11d&#x27;</span>, <span class="string">&#x27;d11e&#x27;</span>, <span class="string">&#x27;d11f&#x27;</span>, <span class="string">&#x27;d11g&#x27;</span>, <span class="string">&#x27;d11h&#x27;</span>, <span class="string">&#x27;d12&#x27;</span>,  <span class="comment"># social activities</span></span><br><span class="line">                     <span class="string">&#x27;e1&#x27;</span>, <span class="string">&#x27;e2&#x27;</span>, <span class="string">&#x27;e3&#x27;</span>, <span class="string">&#x27;e4&#x27;</span>, <span class="string">&#x27;e5&#x27;</span>, <span class="string">&#x27;e6&#x27;</span>,  <span class="comment"># ADL</span></span><br><span class="line">                     <span class="string">&#x27;g15a1&#x27;</span>, <span class="string">&#x27;g15b1&#x27;</span>, <span class="string">&#x27;g15c1&#x27;</span>, <span class="string">&#x27;g15d1&#x27;</span>, <span class="string">&#x27;g15e1&#x27;</span>, <span class="string">&#x27;g15f1&#x27;</span>, <span class="string">&#x27;g15g1&#x27;</span>, <span class="string">&#x27;g15h1&#x27;</span>, <span class="string">&#x27;g15i1&#x27;</span>, <span class="string">&#x27;g15j1&#x27;</span>, <span class="string">&#x27;g15k1&#x27;</span>,</span><br><span class="line">                     <span class="string">&#x27;g15l1&#x27;</span>, <span class="string">&#x27;g15m1&#x27;</span>, <span class="string">&#x27;g15n1&#x27;</span>, <span class="string">&#x27;g15o1&#x27;</span>,  <span class="comment"># chronic diseases</span></span><br><span class="line">                     <span class="string">&#x27;c11&#x27;</span>, <span class="string">&#x27;c12&#x27;</span>, <span class="string">&#x27;c13&#x27;</span>, <span class="string">&#x27;c14&#x27;</span>, <span class="string">&#x27;c15&#x27;</span>, <span class="string">&#x27;c16&#x27;</span>, <span class="string">&#x27;c21a&#x27;</span>, <span class="string">&#x27;c21b&#x27;</span>, <span class="string">&#x27;c21c&#x27;</span>, <span class="string">&#x27;c31a&#x27;</span>, <span class="string">&#x27;c31b&#x27;</span>, <span class="string">&#x27;c31c&#x27;</span>, <span class="string">&#x27;c31d&#x27;</span>,</span><br><span class="line">                     <span class="string">&#x27;c31e&#x27;</span>, <span class="string">&#x27;c32&#x27;</span>, <span class="string">&#x27;c41a&#x27;</span>, <span class="string">&#x27;c41b&#x27;</span>, <span class="string">&#x27;c41c&#x27;</span>, <span class="string">&#x27;c51a&#x27;</span>, <span class="string">&#x27;c51b&#x27;</span>, <span class="string">&#x27;c52&#x27;</span>, <span class="string">&#x27;c53a&#x27;</span>, <span class="string">&#x27;c53b&#x27;</span>, <span class="string">&#x27;c53c&#x27;</span>,</span><br><span class="line">                     <span class="comment"># CI measurement</span></span><br><span class="line">                     ]</span><br><span class="line">    year_index = <span class="string">&#x27;_&#x27;</span> + <span class="built_in">str</span>(start_year + <span class="number">3</span>)[-<span class="number">1</span>] <span class="keyword">if</span> start_year + <span class="number">3</span> &lt; <span class="number">2010</span> <span class="keyword">else</span> <span class="string">&#x27;_&#x27;</span> + <span class="built_in">str</span>(start_year + <span class="number">3</span>)[-<span class="number">2</span>:]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 根据需要用到的变量名和三年后的后缀 得到 需要用到的三年后的变量名</span></span><br><span class="line">    <span class="comment">## 11年前，后续年份随访调查的年龄字段叫vage_年份； 11年后，后续年份随访调查的年龄字段叫trueage_年份；</span></span><br><span class="line">    <span class="keyword">if</span> start_year != <span class="number">2011</span>:</span><br><span class="line">        three_years_later_columns = <span class="built_in">list</span>(</span><br><span class="line">            <span class="built_in">map</span>(<span class="keyword">lambda</span> x: x + year_index <span class="keyword">if</span> x != <span class="string">&#x27;trueage&#x27;</span> <span class="keyword">else</span> <span class="string">&#x27;vage&#x27;</span> + year_index, basic_columns))</span><br><span class="line">        <span class="built_in">print</span>(three_years_later_columns)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        three_years_later_columns = <span class="built_in">list</span>(<span class="built_in">map</span>(<span class="keyword">lambda</span> x: x + year_index, basic_columns))</span><br><span class="line">        <span class="built_in">print</span>(three_years_later_columns)</span><br><span class="line">    <span class="comment"># 个人信息问题只在初始年记录，后续年没有，把三年后的个人信息问题去掉</span></span><br><span class="line">    <span class="keyword">for</span> personal_stable_variable <span class="keyword">in</span> <span class="built_in">list</span>(<span class="built_in">map</span>(<span class="keyword">lambda</span> x: x + year_index, [<span class="string">&#x27;a2&#x27;</span>, <span class="string">&#x27;f1&#x27;</span>, <span class="string">&#x27;a1&#x27;</span>, <span class="string">&#x27;a41&#x27;</span>, <span class="string">&#x27;a43&#x27;</span>])):</span><br><span class="line">        three_years_later_columns.remove(personal_stable_variable)</span><br><span class="line">    total_columns = basic_columns + three_years_later_columns</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 筛选3年后随访还活着且没失访的老年人</span></span><br><span class="line">    death_index_var = <span class="string">&#x27;dth&#x27;</span> + <span class="built_in">str</span>(start_year)[-<span class="number">2</span>:] + <span class="string">&#x27;_&#x27;</span> + <span class="built_in">str</span>(start_year + <span class="number">3</span>)[-<span class="number">2</span>:]</span><br><span class="line">    <span class="comment">#live_df变量的意思是筛选出还活着的列表</span></span><br><span class="line">    live_df = df[df[death_index_var] == <span class="number">0</span>]</span><br><span class="line">    <span class="built_in">print</span>(live_df)</span><br><span class="line">    <span class="comment"># 筛选出还活着的列表然后取特定的列变量</span></span><br><span class="line">    wave_data = live_df[total_columns]</span><br><span class="line">    <span class="built_in">print</span>(wave_data)</span><br><span class="line">    <span class="keyword">for</span> column <span class="keyword">in</span> wave_data.columns:</span><br><span class="line">        <span class="comment"># 转为数字型</span></span><br><span class="line">        wave_data[column] = pd.to_numeric(wave_data[column], errors=<span class="string">&#x27;coerce&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> wave_data</span><br></pre></td></tr></table></figure><p>统计各个项的缺失概率，并用众数填补变量的缺失值并把MMSE问题全部不能回答的人去掉</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">replace_abnormal_and_fill_nan</span>(<span class="params">df, start_year</span>):</span><br><span class="line">    <span class="comment"># 以下问题的问卷选项中存在官方的取值8，或者有可能出现取值8。所以不能将这些变量的8作为缺失处理</span></span><br><span class="line">    questions_may_contain8 = [<span class="string">&#x27;vage&#x27;</span>, <span class="string">&#x27;trueage&#x27;</span>, <span class="string">&#x27;a2&#x27;</span>, <span class="string">&#x27;a41&#x27;</span>, <span class="string">&#x27;f1&#x27;</span>, <span class="string">&#x27;b21&#x27;</span>, <span class="string">&#x27;b22&#x27;</span>, <span class="string">&#x27;b23&#x27;</span>, <span class="string">&#x27;b24&#x27;</span>, <span class="string">&#x27;b25&#x27;</span>, <span class="string">&#x27;b26&#x27;</span>, <span class="string">&#x27;b27&#x27;</span>,</span><br><span class="line">                              <span class="string">&#x27;d75&#x27;</span>, <span class="string">&#x27;d86&#x27;</span>, <span class="string">&#x27;d12&#x27;</span>, <span class="string">&#x27;c11&#x27;</span>, <span class="string">&#x27;c12&#x27;</span>, <span class="string">&#x27;c13&#x27;</span>, <span class="string">&#x27;c14&#x27;</span>, <span class="string">&#x27;c15&#x27;</span>, <span class="string">&#x27;c16&#x27;</span>, <span class="string">&#x27;c21a&#x27;</span>, <span class="string">&#x27;c21b&#x27;</span>, <span class="string">&#x27;c21c&#x27;</span>,</span><br><span class="line">                              <span class="string">&#x27;c31a&#x27;</span>, <span class="string">&#x27;c31b&#x27;</span>, <span class="string">&#x27;c31c&#x27;</span>, <span class="string">&#x27;c31d&#x27;</span>, <span class="string">&#x27;c31e&#x27;</span>, <span class="string">&#x27;c32&#x27;</span>, <span class="string">&#x27;c41a&#x27;</span>, <span class="string">&#x27;c41b&#x27;</span>, <span class="string">&#x27;c41c&#x27;</span>, <span class="string">&#x27;c51a&#x27;</span>, <span class="string">&#x27;c51b&#x27;</span>,</span><br><span class="line">                              <span class="string">&#x27;c52&#x27;</span>, <span class="string">&#x27;c53a&#x27;</span>, <span class="string">&#x27;c53b&#x27;</span>, <span class="string">&#x27;c53c&#x27;</span>]</span><br><span class="line">    year_index = <span class="string">&#x27;_&#x27;</span> + <span class="built_in">str</span>(start_year + <span class="number">3</span>)[-<span class="number">1</span>] <span class="keyword">if</span> start_year + <span class="number">3</span> &lt; <span class="number">2010</span> <span class="keyword">else</span> <span class="string">&#x27;_&#x27;</span> + <span class="built_in">str</span>(start_year + <span class="number">3</span>)[-<span class="number">2</span>:]</span><br><span class="line">    later_questions_may_contain8 = <span class="built_in">list</span>(<span class="built_in">map</span>(<span class="keyword">lambda</span> x: x + year_index, questions_may_contain8))</span><br><span class="line">    total_questions_may_contain8 = questions_may_contain8 + later_questions_may_contain8</span><br><span class="line">    <span class="comment"># 把剩下的变量中的按codebook说明的缺失取值或不合理取值变成缺失值。</span></span><br><span class="line">    variable_needed_processed = <span class="built_in">list</span>(<span class="built_in">set</span>(df.columns) - <span class="built_in">set</span>(total_questions_may_contain8))</span><br><span class="line">    new_df = df.copy()</span><br><span class="line">    <span class="keyword">for</span> var <span class="keyword">in</span> variable_needed_processed:</span><br><span class="line">        new_df[var] = new_df[var].replace(<span class="number">8</span>, np.nan)</span><br><span class="line">        new_df[var] = new_df[var].replace(<span class="number">88</span>, np.nan)</span><br><span class="line">        new_df[var] = new_df[var].replace(<span class="number">888</span>, np.nan)</span><br><span class="line">        new_df[var] = new_df[var].replace(<span class="number">8888</span>, np.nan)</span><br><span class="line">        new_df[var] = new_df[var].replace(<span class="number">9</span>, np.nan)</span><br><span class="line">        new_df[var] = new_df[var].replace(<span class="number">99</span>, np.nan)</span><br><span class="line">        new_df[var] = new_df[var].replace(<span class="number">99</span>, np.nan)</span><br><span class="line">        new_df[var] = new_df[var].replace(<span class="number">9999</span>, np.nan)</span><br><span class="line">    <span class="comment"># 用众数填补变量的缺失值</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Missing values situation&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(</span><br><span class="line">        (new_df.loc[:, new_df.isnull().<span class="built_in">any</span>()].isnull().<span class="built_in">sum</span>() / <span class="built_in">len</span>(df)).apply(<span class="keyword">lambda</span> x: <span class="built_in">str</span>(<span class="string">&#x27;%.2f&#x27;</span> % (x * <span class="number">100</span>)) + <span class="string">&#x27;%&#x27;</span>))</span><br><span class="line">    <span class="keyword">for</span> col <span class="keyword">in</span> new_df.columns[new_df.isnull().<span class="built_in">any</span>()]:</span><br><span class="line">        mode = new_df[col].value_counts().sort_values(ascending=<span class="literal">False</span>).index[<span class="number">0</span>]</span><br><span class="line">        new_df[col].fillna(mode, inplace=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 去掉MMSE问题全部不能回答的</span></span><br><span class="line">    MMSE_questions = [<span class="string">&#x27;c11&#x27;</span>, <span class="string">&#x27;c12&#x27;</span>, <span class="string">&#x27;c13&#x27;</span>, <span class="string">&#x27;c14&#x27;</span>, <span class="string">&#x27;c15&#x27;</span>, <span class="string">&#x27;c21a&#x27;</span>, <span class="string">&#x27;c21b&#x27;</span>, <span class="string">&#x27;c21c&#x27;</span>, <span class="string">&#x27;c31a&#x27;</span>, <span class="string">&#x27;c31b&#x27;</span>, <span class="string">&#x27;c31c&#x27;</span>, <span class="string">&#x27;c31d&#x27;</span>, <span class="string">&#x27;c31e&#x27;</span>,</span><br><span class="line">                      <span class="string">&#x27;c32&#x27;</span>, <span class="string">&#x27;c41a&#x27;</span>, <span class="string">&#x27;c41b&#x27;</span>, <span class="string">&#x27;c41c&#x27;</span>, <span class="string">&#x27;c51a&#x27;</span>, <span class="string">&#x27;c51b&#x27;</span>, <span class="string">&#x27;c52&#x27;</span>, <span class="string">&#x27;c53a&#x27;</span>, <span class="string">&#x27;c53b&#x27;</span>, <span class="string">&#x27;c53c&#x27;</span>]</span><br><span class="line">    MMSE_questions_later = <span class="built_in">list</span>(<span class="built_in">map</span>(<span class="keyword">lambda</span> x: x + year_index, MMSE_questions))</span><br><span class="line">    <span class="keyword">for</span> var <span class="keyword">in</span> MMSE_questions:</span><br><span class="line">        new_df[var] = new_df[var].replace(<span class="number">8</span>, np.nan)</span><br><span class="line">        new_df[var] = new_df[var].replace(<span class="number">88</span>, np.nan)</span><br><span class="line">        new_df[var] = new_df[var].replace(<span class="number">888</span>, np.nan)</span><br><span class="line">        new_df[var] = new_df[var].replace(<span class="number">8888</span>, np.nan)</span><br><span class="line">        new_df[var] = new_df[var].replace(<span class="number">9</span>, np.nan)</span><br><span class="line">        new_df[var] = new_df[var].replace(<span class="number">99</span>, np.nan)</span><br><span class="line">        new_df[var] = new_df[var].replace(<span class="number">99</span>, np.nan)</span><br><span class="line">        new_df[var] = new_df[var].replace(<span class="number">9999</span>, np.nan)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Samples before drop current MMSE missing : &#x27;</span>, <span class="built_in">len</span>(new_df))</span><br><span class="line">    new_df = new_df[new_df.isnull().<span class="built_in">sum</span>(axis=<span class="number">1</span>) &lt; <span class="number">23</span>]</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Samples before drop current MMSE missing : &#x27;</span>, <span class="built_in">len</span>(new_df))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> var <span class="keyword">in</span> MMSE_questions_later:</span><br><span class="line">        new_df[var] = new_df[var].replace(<span class="number">8</span>, np.nan)</span><br><span class="line">        new_df[var] = new_df[var].replace(<span class="number">88</span>, np.nan)</span><br><span class="line">        new_df[var] = new_df[var].replace(<span class="number">888</span>, np.nan)</span><br><span class="line">        new_df[var] = new_df[var].replace(<span class="number">8888</span>, np.nan)</span><br><span class="line">        new_df[var] = new_df[var].replace(<span class="number">9</span>, np.nan)</span><br><span class="line">        new_df[var] = new_df[var].replace(<span class="number">99</span>, np.nan)</span><br><span class="line">        new_df[var] = new_df[var].replace(<span class="number">99</span>, np.nan)</span><br><span class="line">        new_df[var] = new_df[var].replace(<span class="number">9999</span>, np.nan)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Samples before drop later MMSE missing : &#x27;</span>, <span class="built_in">len</span>(new_df))</span><br><span class="line">    new_df = new_df[new_df.isnull().<span class="built_in">sum</span>(axis=<span class="number">1</span>) &lt; <span class="number">23</span>]</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Samples before drop later MMSE missing : &#x27;</span>, <span class="built_in">len</span>(new_df))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> new_df</span><br></pre></td></tr></table></figure><p>整合并筛选出&gt;60岁的人</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_period_data</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Reading data ...&#x27;</span>)</span><br><span class="line">    data_02to18 = pd.read_csv(<span class="string">&#x27;./data/clhls_2002_2018_utf8.csv&#x27;</span>,low_memory=<span class="literal">False</span>)</span><br><span class="line">    data_05to18 = pd.read_csv(<span class="string">&#x27;./data/clhls_2005_2018_utf8.csv&#x27;</span>,low_memory=<span class="literal">False</span>)</span><br><span class="line">    data_08to18 = pd.read_csv(<span class="string">&#x27;./data/clhls_2008_2018_utf8.csv&#x27;</span>,low_memory=<span class="literal">False</span>)</span><br><span class="line">    data_11to18 = pd.read_csv(<span class="string">&#x27;./data/clhls_2011_2018_utf8.csv&#x27;</span>,low_memory=<span class="literal">False</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Getting 3 year periods data ...&#x27;</span>)</span><br><span class="line">    data02to05 = get_data_between_start_to_end(data_02to18,<span class="number">2002</span>)</span><br><span class="line">    data05to08 = get_data_between_start_to_end(data_05to18,<span class="number">2005</span>)</span><br><span class="line">    data08to11 = get_data_between_start_to_end(data_08to18,<span class="number">2008</span>)</span><br><span class="line">    data11to14 = get_data_between_start_to_end(data_11to18,<span class="number">2011</span>)</span><br><span class="line">    </span><br><span class="line">    situation = get_df_peo_3years_situation(data02to05,data05to08,data08to11,data11to14)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Number of investgated elders situations : &#x27;</span>,<span class="string">&#x27;\n&#x27;</span>,situation)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Selecting needed variables ...&#x27;</span>)</span><br><span class="line">    first_wave = get_wave_data(data02to05,<span class="number">2002</span>)</span><br><span class="line">    second_wave = get_wave_data(data05to08,<span class="number">2005</span>)</span><br><span class="line">    third_wave = get_wave_data(data08to11,<span class="number">2008</span>)</span><br><span class="line">    fourth_wave = get_wave_data(data11to14,<span class="number">2011</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Filling missing values ...&#x27;</span>)</span><br><span class="line">    first_wave_new = replace_abnormal_and_fill_nan(first_wave,<span class="number">2002</span>)</span><br><span class="line">    second_wave_new = replace_abnormal_and_fill_nan(second_wave,<span class="number">2005</span>)</span><br><span class="line">    third_wave_new = replace_abnormal_and_fill_nan(third_wave,<span class="number">2008</span>)</span><br><span class="line">    fourth_wave_new = replace_abnormal_and_fill_nan(fourth_wave,<span class="number">2011</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Before drop age&lt;60 : &#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Wave 1: &#x27;</span>,<span class="built_in">len</span>(first_wave_new))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Wave 2: &#x27;</span>,<span class="built_in">len</span>(second_wave_new))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Wave 3: &#x27;</span>,<span class="built_in">len</span>(third_wave_new))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Wave 4: &#x27;</span>,<span class="built_in">len</span>(fourth_wave_new))</span><br><span class="line">    first_wave_new = first_wave_new[first_wave_new.trueage&gt;=<span class="number">60</span>]</span><br><span class="line">    second_wave_new = second_wave_new[second_wave_new.trueage&gt;=<span class="number">60</span>]</span><br><span class="line">    third_wave_new = third_wave_new[third_wave_new.trueage&gt;=<span class="number">60</span>]</span><br><span class="line">    fourth_wave_new = fourth_wave_new[fourth_wave_new.trueage&gt;=<span class="number">60</span>]</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;After drop age&lt;60 : &#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Wave 1: &#x27;</span>,<span class="built_in">len</span>(first_wave_new))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Wave 2: &#x27;</span>,<span class="built_in">len</span>(second_wave_new))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Wave 3: &#x27;</span>,<span class="built_in">len</span>(third_wave_new))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Wave 4: &#x27;</span>,<span class="built_in">len</span>(fourth_wave_new))</span><br><span class="line">    <span class="keyword">return</span> first_wave_new,second_wave_new,third_wave_new,fourth_wave_new</span><br></pre></td></tr></table></figure><p>第二部分获得CI score，depression score，ADL score三项的分数<br>先定位到CI score，depression score，ADL score三项的变量</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## CI score</span></span><br><span class="line">    new_df = df.copy()</span><br><span class="line">    current_questions = [<span class="string">&#x27;c11&#x27;</span>,<span class="string">&#x27;c12&#x27;</span>,<span class="string">&#x27;c13&#x27;</span>,<span class="string">&#x27;c14&#x27;</span>,<span class="string">&#x27;c15&#x27;</span>,<span class="string">&#x27;c16&#x27;</span>,<span class="string">&#x27;c21a&#x27;</span>,<span class="string">&#x27;c21b&#x27;</span>,<span class="string">&#x27;c21c&#x27;</span>,<span class="string">&#x27;c31a&#x27;</span>,<span class="string">&#x27;c31b&#x27;</span>,<span class="string">&#x27;c31c&#x27;</span>,<span class="string">&#x27;c31d&#x27;</span>,<span class="string">&#x27;c31e&#x27;</span>,<span class="string">&#x27;c32&#x27;</span>,<span class="string">&#x27;c41a&#x27;</span>,<span class="string">&#x27;c41b&#x27;</span>,<span class="string">&#x27;c41c&#x27;</span>,<span class="string">&#x27;c51a&#x27;</span>,<span class="string">&#x27;c51b&#x27;</span>,<span class="string">&#x27;c52&#x27;</span>,<span class="string">&#x27;c53a&#x27;</span>,<span class="string">&#x27;c53b&#x27;</span>,<span class="string">&#x27;c53c&#x27;</span>]</span><br><span class="line">    year_index = <span class="string">&#x27;_&#x27;</span>+<span class="built_in">str</span>(start_year+<span class="number">3</span>)[-<span class="number">1</span>] <span class="keyword">if</span> start_year + <span class="number">3</span> &lt; <span class="number">2010</span> <span class="keyword">else</span> <span class="string">&#x27;_&#x27;</span>+<span class="built_in">str</span>(start_year+<span class="number">3</span>)[-<span class="number">2</span>:]</span><br><span class="line">    three_year_questions = <span class="built_in">list</span>(<span class="built_in">map</span>(<span class="keyword">lambda</span> x:x+year_index,[<span class="string">&#x27;c11&#x27;</span>,<span class="string">&#x27;c12&#x27;</span>,<span class="string">&#x27;c13&#x27;</span>,<span class="string">&#x27;c14&#x27;</span>,<span class="string">&#x27;c15&#x27;</span>,<span class="string">&#x27;c16&#x27;</span>,<span class="string">&#x27;c21a&#x27;</span>,<span class="string">&#x27;c21b&#x27;</span>,<span class="string">&#x27;c21c&#x27;</span>,<span class="string">&#x27;c31a&#x27;</span>,<span class="string">&#x27;c31b&#x27;</span>,<span class="string">&#x27;c31c&#x27;</span>,<span class="string">&#x27;c31d&#x27;</span>,<span class="string">&#x27;c31e&#x27;</span>,<span class="string">&#x27;c32&#x27;</span>,<span class="string">&#x27;c41a&#x27;</span>,<span class="string">&#x27;c41b&#x27;</span>,<span class="string">&#x27;c41c&#x27;</span>,<span class="string">&#x27;c51a&#x27;</span>,<span class="string">&#x27;c51b&#x27;</span>,<span class="string">&#x27;c52&#x27;</span>,<span class="string">&#x27;c53a&#x27;</span>,<span class="string">&#x27;c53b&#x27;</span>,<span class="string">&#x27;c53c&#x27;</span>]))</span><br><span class="line">    questions = current_questions + three_year_questions</span><br><span class="line"><span class="comment">#     for column in questions:</span></span><br><span class="line"><span class="comment">#         new_df[column] = pd.to_numeric(new_df[column],errors = &#x27;coerce&#x27;)</span></span><br></pre></td></tr></table></figure><p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/340770847">apply()方法</a>，apply()方法中的函数是calculate_CI_score，该函数还是可计算当年统计的CI分数和三年后统计的CI分数，该函数如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">calculate_CI_score</span>(<span class="params">x,periods = <span class="string">&#x27;current&#x27;</span>,start_year = <span class="literal">None</span></span>):</span><br><span class="line">    <span class="keyword">if</span> periods == <span class="string">&#x27;current&#x27;</span>:</span><br><span class="line">        questions = [<span class="string">&#x27;c11&#x27;</span>,<span class="string">&#x27;c12&#x27;</span>,<span class="string">&#x27;c13&#x27;</span>,<span class="string">&#x27;c14&#x27;</span>,<span class="string">&#x27;c15&#x27;</span>,<span class="string">&#x27;c16&#x27;</span>,<span class="string">&#x27;c21a&#x27;</span>,<span class="string">&#x27;c21b&#x27;</span>,<span class="string">&#x27;c21c&#x27;</span>,<span class="string">&#x27;c31a&#x27;</span>,<span class="string">&#x27;c31b&#x27;</span>,<span class="string">&#x27;c31c&#x27;</span>,<span class="string">&#x27;c31d&#x27;</span>,<span class="string">&#x27;c31e&#x27;</span>,<span class="string">&#x27;c32&#x27;</span>,<span class="string">&#x27;c41a&#x27;</span>,<span class="string">&#x27;c41b&#x27;</span>,<span class="string">&#x27;c41c&#x27;</span>,<span class="string">&#x27;c51a&#x27;</span>,<span class="string">&#x27;c51b&#x27;</span>,<span class="string">&#x27;c52&#x27;</span>,<span class="string">&#x27;c53a&#x27;</span>,<span class="string">&#x27;c53b&#x27;</span>,<span class="string">&#x27;c53c&#x27;</span>]</span><br><span class="line">    <span class="keyword">elif</span> periods == <span class="string">&#x27;three_years_later&#x27;</span>:</span><br><span class="line">        year_index = <span class="string">&#x27;_&#x27;</span>+<span class="built_in">str</span>(start_year+<span class="number">3</span>)[-<span class="number">1</span>] <span class="keyword">if</span> start_year + <span class="number">3</span> &lt; <span class="number">2010</span> <span class="keyword">else</span> <span class="string">&#x27;_&#x27;</span>+<span class="built_in">str</span>(start_year+<span class="number">3</span>)[-<span class="number">2</span>:]</span><br><span class="line">        questions = <span class="built_in">list</span>(<span class="built_in">map</span>(<span class="keyword">lambda</span> x:x+year_index,[<span class="string">&#x27;c11&#x27;</span>,<span class="string">&#x27;c12&#x27;</span>,<span class="string">&#x27;c13&#x27;</span>,<span class="string">&#x27;c14&#x27;</span>,<span class="string">&#x27;c15&#x27;</span>,<span class="string">&#x27;c16&#x27;</span>,<span class="string">&#x27;c21a&#x27;</span>,<span class="string">&#x27;c21b&#x27;</span>,<span class="string">&#x27;c21c&#x27;</span>,<span class="string">&#x27;c31a&#x27;</span>,<span class="string">&#x27;c31b&#x27;</span>,<span class="string">&#x27;c31c&#x27;</span>,<span class="string">&#x27;c31d&#x27;</span>,<span class="string">&#x27;c31e&#x27;</span>,<span class="string">&#x27;c32&#x27;</span>,<span class="string">&#x27;c41a&#x27;</span>,<span class="string">&#x27;c41b&#x27;</span>,<span class="string">&#x27;c41c&#x27;</span>,<span class="string">&#x27;c51a&#x27;</span>,<span class="string">&#x27;c51b&#x27;</span>,<span class="string">&#x27;c52&#x27;</span>,<span class="string">&#x27;c53a&#x27;</span>,<span class="string">&#x27;c53b&#x27;</span>,<span class="string">&#x27;c53c&#x27;</span>]))</span><br><span class="line">    CI_score = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> question <span class="keyword">in</span> questions:</span><br><span class="line">        <span class="keyword">if</span> question[<span class="number">0</span>:<span class="number">3</span>] != <span class="string">&#x27;c16&#x27;</span>: <span class="comment">#如果不是数食物的题</span></span><br><span class="line">            <span class="keyword">if</span> x[question] == <span class="number">1</span>:CI_score += <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>: <span class="comment">#如果是数食物的题</span></span><br><span class="line">            food_score = x[question] <span class="keyword">if</span> x[question]&lt;=<span class="number">7</span> <span class="keyword">else</span> <span class="number">7</span></span><br><span class="line">            CI_score += food_score</span><br><span class="line">    <span class="keyword">return</span> CI_score</span><br></pre></td></tr></table></figure><p>具体统计的CI分数和三年后统计的CI分数</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">new_df[<span class="string">&#x27;current_CI_score&#x27;</span>] = new_df.apply(<span class="keyword">lambda</span> x:calculate_CI_score(x),axis = <span class="number">1</span>)</span><br><span class="line">    new_df[<span class="string">&#x27;later_CI_score&#x27;</span>] = new_df.apply(<span class="keyword">lambda</span> x:calculate_CI_score(x,periods = <span class="string">&#x27;three_years_later&#x27;</span>,start_year = start_year),axis = <span class="number">1</span>)</span><br></pre></td></tr></table></figure><p>统计完成后新增了分数列，删除相关变量列，凡是会对原数组作出修改并返回一个新数组的，往往都有一个 inplace可选参数。如果手动设定为True（默认为False），那么原数组直接就被替换。也就是说，采用inplace=True之后，原数组名（如2和3情况所示）对应的内存值直接改变；<br>（1）drop函数的使用：删除行、删除列</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span> frame.drop([<span class="string">&#x27;a&#x27;</span>])</span><br><span class="line"><span class="built_in">print</span> frame.drop([<span class="string">&#x27;Ohio&#x27;</span>], axis = <span class="number">1</span>)</span><br></pre></td></tr></table></figure><p>本文是预测认知障碍，认知障碍被定义为 MMSE 评分低于 18，所以使用函数判断是否有障碍</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_CI_label</span>(<span class="params">x,periods</span>):</span><br><span class="line">    <span class="keyword">if</span> periods == <span class="string">&#x27;current&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span> <span class="keyword">if</span> x.current_CI_score&gt;= <span class="number">18</span> <span class="keyword">else</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> periods == <span class="string">&#x27;three_years_later&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span> <span class="keyword">if</span> x.later_CI_score&gt;= <span class="number">18</span> <span class="keyword">else</span> <span class="number">1</span></span><br></pre></td></tr></table></figure><p>一下代码中清理行变量，人数的关键是<code>new_df.dropna(subset = ['depression_score','depression_score_later'],axis = 0,inplace = True)</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Before drop Depression missing : &#x27;</span>,<span class="built_in">len</span>(new_df))</span><br><span class="line">new_df.drop(questions,axis = <span class="number">1</span>,inplace = <span class="literal">True</span>)</span><br><span class="line">new_df.dropna(subset = [<span class="string">&#x27;depression_score&#x27;</span>,<span class="string">&#x27;depression_score_later&#x27;</span>],axis = <span class="number">0</span>,inplace = <span class="literal">True</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;After drop Depression missing : &#x27;</span>,<span class="built_in">len</span>(new_df))</span><br></pre></td></tr></table></figure><p>计算只留下所有问题都回答了的样本的抑郁得分，其余的depression_score以nan填充，再用<code>new_df.dropna(subset = ['depression_score','depression_score_later'],axis = 0,inplace = True)</code>把nan的人数去除掉<br>变量处理语句</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 性别改为0女，1男</span></span><br><span class="line">df[<span class="string">&#x27;a1&#x27;</span>] = df[<span class="string">&#x27;a1&#x27;</span>].apply(<span class="keyword">lambda</span> x:<span class="number">0</span> <span class="keyword">if</span> x==<span class="number">2</span> <span class="keyword">else</span> <span class="number">1</span>)</span><br></pre></td></tr></table></figure><p>根据a1的单元格数值x修改a1为0女，1男可能是作者习惯吧，然后用<code>def process_personal_variant_variable(df,start_year)</code>也是继续修改赋值<br>总体改变问卷变量的标识使其更容易理解</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_training_df</span>(<span class="params">df1,df2,df3,df4</span>):</span><br><span class="line">    drop_list = [<span class="string">&#x27;d72&#x27;</span>,<span class="string">&#x27;d75&#x27;</span>,<span class="string">&#x27;d82&#x27;</span>,<span class="string">&#x27;d86&#x27;</span>,<span class="string">&#x27;d92&#x27;</span>] <span class="comment"># 用不到的变量</span></span><br><span class="line">    rename_dict_base = &#123;<span class="string">&#x27;a1&#x27;</span>:<span class="string">&#x27;gender&#x27;</span>,<span class="string">&#x27;a43&#x27;</span>:<span class="string">&#x27;residence&#x27;</span>,<span class="string">&#x27;a51&#x27;</span>:<span class="string">&#x27;co-habitation&#x27;</span>,<span class="string">&#x27;d71&#x27;</span>:<span class="string">&#x27;smoke&#x27;</span>,<span class="string">&#x27;d81&#x27;</span>:<span class="string">&#x27;alcohol&#x27;</span>,<span class="string">&#x27;d91&#x27;</span>:<span class="string">&#x27;exercise&#x27;</span>,<span class="string">&#x27;d31&#x27;</span>:<span class="string">&#x27;eat_fruits&#x27;</span>,<span class="string">&#x27;d32&#x27;</span>:<span class="string">&#x27;eat_vegs&#x27;</span>,<span class="string">&#x27;d11b&#x27;</span>:<span class="string">&#x27;outdoor_activity&#x27;</span>,<span class="string">&#x27;d11c&#x27;</span>:<span class="string">&#x27;plant_flower_bird&#x27;</span>,<span class="string">&#x27;d11d&#x27;</span>:<span class="string">&#x27;read_news_books&#x27;</span>,</span><br><span class="line">                          <span class="string">&#x27;d11e&#x27;</span>:<span class="string">&#x27;raise_domestic_animals&#x27;</span>,<span class="string">&#x27;d11f&#x27;</span>:<span class="string">&#x27;majong_or_cards&#x27;</span>,<span class="string">&#x27;d11g&#x27;</span>:<span class="string">&#x27;tv_or_radio&#x27;</span>,<span class="string">&#x27;d11h&#x27;</span>:<span class="string">&#x27;social_activity&#x27;</span>,<span class="string">&#x27;d12&#x27;</span>:<span class="string">&#x27;tour_times&#x27;</span>,</span><br><span class="line">                          <span class="string">&#x27;g15a1&#x27;</span>:<span class="string">&#x27;hypertension&#x27;</span>,<span class="string">&#x27;g15b1&#x27;</span>:<span class="string">&#x27;diabetes&#x27;</span>,<span class="string">&#x27;g15c1&#x27;</span>:<span class="string">&#x27;heart_disease&#x27;</span>,<span class="string">&#x27;g15d1&#x27;</span>:<span class="string">&#x27;stoke_CVD&#x27;</span>,<span class="string">&#x27;g15e1&#x27;</span>:<span class="string">&#x27;trachea_or_lung&#x27;</span>,</span><br><span class="line">                          <span class="string">&#x27;g15f1&#x27;</span>:<span class="string">&#x27;tuberculosis&#x27;</span>,<span class="string">&#x27;g15g1&#x27;</span>:<span class="string">&#x27;cataracts&#x27;</span>,<span class="string">&#x27;g15h1&#x27;</span>:<span class="string">&#x27;glaucoma&#x27;</span>,<span class="string">&#x27;g15i1&#x27;</span>:<span class="string">&#x27;cancer&#x27;</span>,<span class="string">&#x27;g15j1&#x27;</span>:<span class="string">&#x27;prostate&#x27;</span>,<span class="string">&#x27;g15k1&#x27;</span>:<span class="string">&#x27;stomach_ulcer&#x27;</span>,</span><br><span class="line">                          <span class="string">&#x27;g15l1&#x27;</span>:<span class="string">&#x27;Parkinson&#x27;</span>,<span class="string">&#x27;g15m1&#x27;</span>:<span class="string">&#x27;bedsore&#x27;</span>,<span class="string">&#x27;g15n1&#x27;</span>:<span class="string">&#x27;arthritis&#x27;</span>,<span class="string">&#x27;g15o1&#x27;</span>:<span class="string">&#x27;dementia&#x27;</span>&#125; <span class="comment"># 把问卷题目代码改为变量名</span></span><br><span class="line">    later_year = [<span class="number">2005</span>,<span class="number">2008</span>,<span class="number">2011</span>,<span class="number">2014</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> df,year <span class="keyword">in</span> <span class="built_in">zip</span>([df1,df2,df3,df4],later_year):</span><br><span class="line">        year_index = <span class="string">&#x27;_&#x27;</span>+<span class="built_in">str</span>(year)[-<span class="number">1</span>] <span class="keyword">if</span> year&lt;<span class="number">2011</span> <span class="keyword">else</span> <span class="string">&#x27;_&#x27;</span>+<span class="built_in">str</span>(year)[-<span class="number">2</span>:]</span><br><span class="line">        drop_list_later = <span class="built_in">list</span>(<span class="built_in">map</span>(<span class="keyword">lambda</span> x:x+year_index,drop_list))</span><br><span class="line">        rename_dict = rename_dict_base.copy()</span><br><span class="line">        <span class="keyword">for</span> key <span class="keyword">in</span> rename_dict_base.keys():</span><br><span class="line">            later_key = key+year_index</span><br><span class="line">            rename_dict[later_key] = rename_dict[key]+<span class="string">&#x27;_3years_later&#x27;</span></span><br><span class="line"></span><br><span class="line">        df.drop(drop_list+drop_list_later,axis = <span class="number">1</span>,inplace = <span class="literal">True</span>)</span><br><span class="line">        df.rename(columns = rename_dict,inplace = <span class="literal">True</span>)</span><br><span class="line">        </span><br><span class="line">        ind = -<span class="number">2</span> <span class="keyword">if</span> year &lt; <span class="number">2011</span> <span class="keyword">else</span> -<span class="number">3</span></span><br><span class="line">        <span class="keyword">for</span> col <span class="keyword">in</span> df.columns:</span><br><span class="line">            <span class="keyword">if</span> col[ind:] == year_index:</span><br><span class="line">                df.rename(columns = &#123;col:col[:ind]+<span class="string">&#x27;_3years_later&#x27;</span>&#125;,inplace = <span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">return</span> pd.concat([df1,df2,df3,df4],axis = <span class="number">0</span>)</span><br></pre></td></tr></table></figure><p>构建CI分数变化值，如遇到数值型变量则先标准化，<a target="_blank" rel="noopener" href="https://blog.csdn.net/iqdutao/article/details/107464701">特征工程中的样本不均衡处理方法是本代码中的重点</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_total_df</span>(<span class="params">wave1,wave2,wave3,wave4</span>):</span><br><span class="line">    df1 = wave1.copy()</span><br><span class="line">    df2 = wave2.copy()</span><br><span class="line">    df3 = wave3.copy()</span><br><span class="line">    df4 = wave4.copy()</span><br><span class="line"></span><br><span class="line">    total_df = get_training_df(df1,df2,df3,df4)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#### 补处理</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 去掉得痴呆症的老人，痴呆会对CI有影响</span></span><br><span class="line">    total_df = total_df[total_df.dementia == <span class="number">0</span>]</span><br><span class="line">    total_df = total_df[total_df.dementia_3years_later == <span class="number">0</span>]</span><br><span class="line">    <span class="keyword">del</span> total_df[<span class="string">&#x27;dementia&#x27;</span>]</span><br><span class="line">    <span class="keyword">del</span> total_df[<span class="string">&#x27;dementia_3years_later&#x27;</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 标准化数值型变量</span></span><br><span class="line">    scaler1,scaler2,scaler3,scaler4 = StandardScaler(),StandardScaler(),StandardScaler(),StandardScaler()</span><br><span class="line">    total_df[<span class="string">&#x27;depression_score&#x27;</span>] = scaler1.fit_transform(np.array(total_df[<span class="string">&#x27;depression_score&#x27;</span>]).reshape(-<span class="number">1</span>,<span class="number">1</span>))</span><br><span class="line">    total_df[<span class="string">&#x27;depression_score_later&#x27;</span>] = scaler2.fit_transform(np.array(total_df[<span class="string">&#x27;depression_score_later&#x27;</span>]).reshape(-<span class="number">1</span>,<span class="number">1</span>))</span><br><span class="line">    total_df[<span class="string">&#x27;tour_times&#x27;</span>] = scaler3.fit_transform(np.array(total_df[<span class="string">&#x27;tour_times&#x27;</span>]).reshape(-<span class="number">1</span>,<span class="number">1</span>))</span><br><span class="line">    total_df[<span class="string">&#x27;tour_times_3years_later&#x27;</span>] = scaler4.fit_transform(np.array(total_df[<span class="string">&#x27;tour_times_3years_later&#x27;</span>]).reshape(-<span class="number">1</span>,<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 构建变量：CI分数变化值</span></span><br><span class="line">    total_df[<span class="string">&#x27;CI_diff&#x27;</span>] = total_df[<span class="string">&#x27;later_CI_score&#x27;</span>] - total_df[<span class="string">&#x27;current_CI_score&#x27;</span>]</span><br><span class="line">    <span class="keyword">return</span> total_df</span><br></pre></td></tr></table></figure><p>以下代码用于统计性别属性中，认知障碍是否有认知障碍的人数和占比，<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/101284491">Groupby用法</a>,读取第二列的值<code>data1 = data.iloc[:, 1]</code><br>对某个特征<code>var</code>的总体CI进行分类</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_categorical_describe</span>(<span class="params">total_df,var</span>):</span><br><span class="line">    grouped = total_df.groupby([<span class="string">&#x27;later_CI&#x27;</span>,var]).count().iloc[:,<span class="number">1</span>]</span><br><span class="line">    not_CI = grouped[<span class="built_in">list</span>(<span class="built_in">map</span>(<span class="keyword">lambda</span> x:<span class="literal">True</span> <span class="keyword">if</span> x[<span class="number">0</span>]==<span class="number">0</span> <span class="keyword">else</span> <span class="literal">False</span>,<span class="built_in">list</span>(grouped.index)))]</span><br><span class="line">    CI = grouped[<span class="built_in">list</span>(<span class="built_in">map</span>(<span class="keyword">lambda</span> x:<span class="literal">True</span> <span class="keyword">if</span> x[<span class="number">0</span>]==<span class="number">1</span> <span class="keyword">else</span> <span class="literal">False</span>,<span class="built_in">list</span>(grouped.index)))]</span><br><span class="line">    res_notCI = [<span class="number">0</span>]*<span class="built_in">len</span>(total_df[var].unique())</span><br><span class="line">    res_CI = [<span class="number">0</span>]*<span class="built_in">len</span>(total_df[var].unique())</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(not_CI)):</span><br><span class="line">        res_notCI[i] = <span class="built_in">str</span>(not_CI.iloc[i])+ <span class="string">&#x27;(&#x27;</span> + <span class="built_in">str</span>(<span class="string">&#x27;%.2f&#x27;</span> %(not_CI.iloc[i]/(not_CI.iloc[i]+CI.iloc[i])*<span class="number">100</span>)) +<span class="string">&#x27;)&#x27;</span></span><br><span class="line">        res_CI[i] = <span class="built_in">str</span>(CI.iloc[i]) + <span class="string">&#x27;(&#x27;</span> + <span class="built_in">str</span>(<span class="string">&#x27;%.2f&#x27;</span> %(CI.iloc[i]/(not_CI.iloc[i]+CI.iloc[i])*<span class="number">100</span>)) + <span class="string">&#x27;)&#x27;</span></span><br><span class="line">    df = pd.concat([pd.DataFrame(res_notCI),pd.DataFrame(res_CI)],axis = <span class="number">1</span>)</span><br><span class="line">    df.columns = [<span class="string">&#x27;not_CI&#x27;</span>,<span class="string">&#x27;CI&#x27;</span>]</span><br><span class="line">    <span class="keyword">return</span> df</span><br></pre></td></tr></table></figure><p>按vae变量算later_CI的Mean(SD)值,重点在于理解<code>mean_ = total_df.groupby('later_CI').mean()[var]</code><br>在期刊论文中表示标准差时，请写成“mean (SD)”也就是说输出的第一个变量是mean，第二个变量是标准差SD</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_numerical_describe</span>(<span class="params">total_df,var</span>):</span><br><span class="line">    mean_ = total_df.groupby(<span class="string">&#x27;later_CI&#x27;</span>).mean()[var]</span><br><span class="line">    std_ = total_df.groupby(<span class="string">&#x27;later_CI&#x27;</span>).std()[var]</span><br><span class="line">    res = [<span class="number">0</span>]*<span class="built_in">len</span>(mean_)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(mean_)):</span><br><span class="line">        res[i] = <span class="built_in">str</span>(<span class="string">&#x27;%.4f&#x27;</span> %mean_[i]) + <span class="string">&#x27;(&#x27;</span> + <span class="built_in">str</span>(<span class="string">&#x27;%.4f&#x27;</span> %std_[i]) + <span class="string">&#x27;)&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> pd.DataFrame(&#123;<span class="string">&#x27;not_CI&#x27;</span>:res[<span class="number">0</span>],<span class="string">&#x27;CI&#x27;</span>:res[<span class="number">1</span>]&#125;,index = [<span class="string">&#x27;Mean(SD)&#x27;</span>])</span><br></pre></td></tr></table></figure><p>默认情况下，pandas 是不超出屏幕的显示范围的，如果表的行数很多，它会截断中间的行只显示一部分。我们可以通过设置display.max_rows来控制显示的最大行数，比如我想设置显示200行。<code>pd.set_option('display.max_rows', 200)</code><br>然后统计统计各个变量的函数</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_var_describe_test</span>(<span class="params">df,var</span>):</span><br><span class="line">    population = <span class="built_in">list</span>(df.groupby(var).count().iloc[:,<span class="number">1</span>].sort_index())</span><br><span class="line">    population_rate = <span class="built_in">list</span>(<span class="built_in">map</span>(<span class="keyword">lambda</span> x:<span class="built_in">str</span>(x)+<span class="string">&#x27;(&#x27;</span>+<span class="built_in">str</span>(<span class="string">&#x27;&#123;:.2f&#125;&#x27;</span>.<span class="built_in">format</span>(x/<span class="built_in">sum</span>(population)*<span class="number">100</span>))+<span class="string">&#x27;%&#x27;</span>+<span class="string">&#x27;)&#x27;</span>,population))</span><br><span class="line">    value_index = <span class="built_in">list</span>(df.groupby(var).count().iloc[:,<span class="number">1</span>].sort_index().index)</span><br><span class="line"></span><br><span class="line">    current_CI_count = df.groupby([var,<span class="string">&#x27;current_CI&#x27;</span>]).count().iloc[:,<span class="number">1</span>]</span><br><span class="line">    CI_now_index = <span class="built_in">list</span>(<span class="built_in">map</span>(<span class="keyword">lambda</span> x:<span class="literal">True</span> <span class="keyword">if</span> x[<span class="number">1</span>] == <span class="number">1</span> <span class="keyword">else</span> <span class="literal">False</span>,current_CI_count.index))</span><br><span class="line">    not_CI_now_index = <span class="built_in">list</span>(<span class="built_in">map</span>(<span class="keyword">lambda</span> x:<span class="literal">True</span> <span class="keyword">if</span> x[<span class="number">1</span>] == <span class="number">0</span> <span class="keyword">else</span> <span class="literal">False</span>,current_CI_count.index))</span><br><span class="line">    CI_now_population = <span class="built_in">list</span>(current_CI_count[CI_now_index])</span><br><span class="line">    not_CI_now_population = <span class="built_in">list</span>(current_CI_count[not_CI_now_index])</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> i,value <span class="keyword">in</span> <span class="built_in">enumerate</span>(not_CI_now_population):</span><br><span class="line">        <span class="keyword">if</span> value/population[i]  == <span class="number">1</span>:<span class="comment"># 如果某组去都没有CI，为了保持列表长度相同，在CI组补0</span></span><br><span class="line">            CI_now_population.insert(i,<span class="number">0</span>)</span><br><span class="line">        not_CI_now_population[i] = <span class="built_in">str</span>(not_CI_now_population[i])+<span class="string">&#x27;(&#x27;</span>+<span class="built_in">str</span>(<span class="string">&#x27;&#123;:.2f&#125;&#x27;</span>.<span class="built_in">format</span>(not_CI_now_population[i]/population[i]*<span class="number">100</span>))+<span class="string">&#x27;%&#x27;</span>+<span class="string">&#x27;)&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i,value <span class="keyword">in</span> <span class="built_in">enumerate</span>(CI_now_population):</span><br><span class="line">        CI_now_population[i] = <span class="built_in">str</span>(CI_now_population[i])+<span class="string">&#x27;(&#x27;</span>+<span class="built_in">str</span>(<span class="string">&#x27;&#123;:.2f&#125;&#x27;</span>.<span class="built_in">format</span>(CI_now_population[i]/population[i]*<span class="number">100</span>))+<span class="string">&#x27;%&#x27;</span>+<span class="string">&#x27;)&#x27;</span></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    later_CI_count = df.groupby([var,<span class="string">&#x27;later_CI&#x27;</span>]).count().iloc[:,<span class="number">1</span>]</span><br><span class="line">    CI_later_index = <span class="built_in">list</span>(<span class="built_in">map</span>(<span class="keyword">lambda</span> x:<span class="literal">True</span> <span class="keyword">if</span> x[<span class="number">1</span>] == <span class="number">1</span> <span class="keyword">else</span> <span class="literal">False</span>,later_CI_count.index))</span><br><span class="line">    not_CI_later_index = <span class="built_in">list</span>(<span class="built_in">map</span>(<span class="keyword">lambda</span> x:<span class="literal">True</span> <span class="keyword">if</span> x[<span class="number">1</span>] == <span class="number">0</span> <span class="keyword">else</span> <span class="literal">False</span>,later_CI_count.index))</span><br><span class="line">    CI_later_population = <span class="built_in">list</span>(later_CI_count[CI_later_index])</span><br><span class="line">    not_CI_later_population = <span class="built_in">list</span>(later_CI_count[not_CI_later_index])</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> i,value <span class="keyword">in</span> <span class="built_in">enumerate</span>(not_CI_later_population):</span><br><span class="line">        <span class="keyword">if</span> value/population[i]  == <span class="number">1</span>:<span class="comment"># 如果某组去都没有CI，为了保持列表长度相同，在CI组补0</span></span><br><span class="line">            CI_later_population.insert(i,<span class="number">0</span>)</span><br><span class="line">        not_CI_later_population[i] = <span class="built_in">str</span>(not_CI_later_population[i])+<span class="string">&#x27;(&#x27;</span>+<span class="built_in">str</span>(<span class="string">&#x27;&#123;:.2f&#125;&#x27;</span>.<span class="built_in">format</span>(not_CI_later_population[i]/population[i]*<span class="number">100</span>))+<span class="string">&#x27;%&#x27;</span>+<span class="string">&#x27;)&#x27;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> i,value <span class="keyword">in</span> <span class="built_in">enumerate</span>(CI_later_population):</span><br><span class="line">        CI_later_population[i] = <span class="built_in">str</span>(CI_later_population[i])+<span class="string">&#x27;(&#x27;</span>+<span class="built_in">str</span>(<span class="string">&#x27;&#123;:.2f&#125;&#x27;</span>.<span class="built_in">format</span>(CI_later_population[i]/population[i]*<span class="number">100</span>))+<span class="string">&#x27;%&#x27;</span>+<span class="string">&#x27;)&#x27;</span></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> pd.DataFrame(&#123;<span class="string">&#x27;value&#x27;</span>:value_index,<span class="string">&#x27;population&#x27;</span>:population_rate,<span class="string">&#x27;CI now&#x27;</span>:CI_now_population,<span class="string">&#x27;not CI now&#x27;</span>:not_CI_now_population,</span><br><span class="line">                          <span class="string">&#x27;CI 3 years later&#x27;</span>:CI_later_population,<span class="string">&#x27;not CI 3 years later&#x27;</span>:not_CI_later_population&#125;)</span><br></pre></td></tr></table></figure><p>在第一部分代码中最后还对各个变量进行了假设检验,python内置values()函数返回一个字典中所有值。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_pvalues</span>(<span class="params">total_df</span>):</span><br><span class="line">    var_list = [<span class="string">&#x27;agegroup&#x27;</span>,<span class="string">&#x27;nation_group&#x27;</span>,<span class="string">&#x27;education&#x27;</span>,<span class="string">&#x27;martial_status&#x27;</span>,<span class="string">&#x27;economy_status&#x27;</span>,<span class="string">&#x27;ADL&#x27;</span>]</span><br><span class="line">    rename_dict_base = &#123;<span class="string">&#x27;a1&#x27;</span>:<span class="string">&#x27;gender&#x27;</span>,<span class="string">&#x27;a43&#x27;</span>:<span class="string">&#x27;residence&#x27;</span>,<span class="string">&#x27;a51&#x27;</span>:<span class="string">&#x27;co-habitation&#x27;</span>,<span class="string">&#x27;d71&#x27;</span>:<span class="string">&#x27;smoke&#x27;</span>,<span class="string">&#x27;d81&#x27;</span>:<span class="string">&#x27;alcohol&#x27;</span>,<span class="string">&#x27;d91&#x27;</span>:<span class="string">&#x27;exercise&#x27;</span>,<span class="string">&#x27;d31&#x27;</span>:<span class="string">&#x27;eat_fruits&#x27;</span>,<span class="string">&#x27;d32&#x27;</span>:<span class="string">&#x27;eat_vegs&#x27;</span>,<span class="string">&#x27;d11b&#x27;</span>:<span class="string">&#x27;outdoor_activity&#x27;</span>,<span class="string">&#x27;d11c&#x27;</span>:<span class="string">&#x27;plant_flower_bird&#x27;</span>,<span class="string">&#x27;d11d&#x27;</span>:<span class="string">&#x27;read_news_books&#x27;</span>,</span><br><span class="line">                          <span class="string">&#x27;d11e&#x27;</span>:<span class="string">&#x27;raise_domestic_animals&#x27;</span>,<span class="string">&#x27;d11f&#x27;</span>:<span class="string">&#x27;majong_or_cards&#x27;</span>,<span class="string">&#x27;d11g&#x27;</span>:<span class="string">&#x27;tv_or_radio&#x27;</span>,<span class="string">&#x27;d11h&#x27;</span>:<span class="string">&#x27;social_activity&#x27;</span>,</span><br><span class="line">                          <span class="string">&#x27;g15a1&#x27;</span>:<span class="string">&#x27;hypertension&#x27;</span>,<span class="string">&#x27;g15b1&#x27;</span>:<span class="string">&#x27;diabetes&#x27;</span>,<span class="string">&#x27;g15c1&#x27;</span>:<span class="string">&#x27;heart_disease&#x27;</span>,<span class="string">&#x27;g15d1&#x27;</span>:<span class="string">&#x27;stoke_CVD&#x27;</span>,<span class="string">&#x27;g15e1&#x27;</span>:<span class="string">&#x27;trachea_or_lung&#x27;</span>,</span><br><span class="line">                          <span class="string">&#x27;g15f1&#x27;</span>:<span class="string">&#x27;tuberculosis&#x27;</span>,<span class="string">&#x27;g15g1&#x27;</span>:<span class="string">&#x27;cataracts&#x27;</span>,<span class="string">&#x27;g15h1&#x27;</span>:<span class="string">&#x27;glaucoma&#x27;</span>,<span class="string">&#x27;g15i1&#x27;</span>:<span class="string">&#x27;cancer&#x27;</span>,<span class="string">&#x27;g15j1&#x27;</span>:<span class="string">&#x27;prostate&#x27;</span>,<span class="string">&#x27;g15k1&#x27;</span>:<span class="string">&#x27;stomach_ulcer&#x27;</span>,</span><br><span class="line">                          <span class="string">&#x27;g15l1&#x27;</span>:<span class="string">&#x27;Parkinson&#x27;</span>,<span class="string">&#x27;g15m1&#x27;</span>:<span class="string">&#x27;bedsore&#x27;</span>,<span class="string">&#x27;g15n1&#x27;</span>:<span class="string">&#x27;arthritis&#x27;</span>&#125;</span><br><span class="line">    descrptive_vars = var_list + <span class="built_in">list</span>(rename_dict_base.values())</span><br><span class="line">    numerical_vars = [<span class="string">&#x27;depression_score&#x27;</span>,<span class="string">&#x27;tour_times&#x27;</span>]</span><br><span class="line">    var_name = []</span><br><span class="line">    pvalues = []</span><br><span class="line">    <span class="keyword">for</span> var <span class="keyword">in</span> descrptive_vars:</span><br><span class="line">        kf_data = np.array(total_df.groupby([<span class="string">&#x27;later_CI&#x27;</span>,var]).count().iloc[:,<span class="number">0</span>]).reshape(<span class="number">2</span>,<span class="built_in">len</span>(total_df[var].unique()))</span><br><span class="line">        kf = chi2_contingency(kf_data)</span><br><span class="line">        var_name.append(var)</span><br><span class="line">        pvalues.append(kf[<span class="number">1</span>])</span><br><span class="line">    <span class="keyword">for</span> var <span class="keyword">in</span> numerical_vars:</span><br><span class="line">        a = total_df[total_df.later_CI == <span class="number">0</span>][var]</span><br><span class="line">        b = total_df[total_df.later_CI == <span class="number">1</span>][var]</span><br><span class="line">        t_res = ttest_ind(a, b)</span><br><span class="line">        var_name.append(var)</span><br><span class="line">        pvalues.append(t_res.pvalue)</span><br><span class="line">    df_out = pd.DataFrame(&#123;<span class="string">&#x27;Variable&#x27;</span>:var_name,<span class="string">&#x27;p-values&#x27;</span>:pvalues&#125;)</span><br><span class="line">    <span class="keyword">return</span> df_out</span><br></pre></td></tr></table></figure><p>p值检验，descrptive_vars和numerical_vars的p值算法是不一样的，前者用chi2_contingency卡方检验后者用ttest_ind</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_pvalues</span>(<span class="params">total_df</span>):</span><br><span class="line">    var_list = [<span class="string">&#x27;agegroup&#x27;</span>,<span class="string">&#x27;nation_group&#x27;</span>,<span class="string">&#x27;education&#x27;</span>,<span class="string">&#x27;martial_status&#x27;</span>,<span class="string">&#x27;economy_status&#x27;</span>,<span class="string">&#x27;ADL&#x27;</span>]</span><br><span class="line">    rename_dict_base = &#123;<span class="string">&#x27;a1&#x27;</span>:<span class="string">&#x27;gender&#x27;</span>,<span class="string">&#x27;a43&#x27;</span>:<span class="string">&#x27;residence&#x27;</span>,<span class="string">&#x27;a51&#x27;</span>:<span class="string">&#x27;co-habitation&#x27;</span>,<span class="string">&#x27;d71&#x27;</span>:<span class="string">&#x27;smoke&#x27;</span>,<span class="string">&#x27;d81&#x27;</span>:<span class="string">&#x27;alcohol&#x27;</span>,<span class="string">&#x27;d91&#x27;</span>:<span class="string">&#x27;exercise&#x27;</span>,<span class="string">&#x27;d31&#x27;</span>:<span class="string">&#x27;eat_fruits&#x27;</span>,<span class="string">&#x27;d32&#x27;</span>:<span class="string">&#x27;eat_vegs&#x27;</span>,<span class="string">&#x27;d11b&#x27;</span>:<span class="string">&#x27;outdoor_activity&#x27;</span>,<span class="string">&#x27;d11c&#x27;</span>:<span class="string">&#x27;plant_flower_bird&#x27;</span>,<span class="string">&#x27;d11d&#x27;</span>:<span class="string">&#x27;read_news_books&#x27;</span>,</span><br><span class="line">                          <span class="string">&#x27;d11e&#x27;</span>:<span class="string">&#x27;raise_domestic_animals&#x27;</span>,<span class="string">&#x27;d11f&#x27;</span>:<span class="string">&#x27;majong_or_cards&#x27;</span>,<span class="string">&#x27;d11g&#x27;</span>:<span class="string">&#x27;tv_or_radio&#x27;</span>,<span class="string">&#x27;d11h&#x27;</span>:<span class="string">&#x27;social_activity&#x27;</span>,</span><br><span class="line">                          <span class="string">&#x27;g15a1&#x27;</span>:<span class="string">&#x27;hypertension&#x27;</span>,<span class="string">&#x27;g15b1&#x27;</span>:<span class="string">&#x27;diabetes&#x27;</span>,<span class="string">&#x27;g15c1&#x27;</span>:<span class="string">&#x27;heart_disease&#x27;</span>,<span class="string">&#x27;g15d1&#x27;</span>:<span class="string">&#x27;stoke_CVD&#x27;</span>,<span class="string">&#x27;g15e1&#x27;</span>:<span class="string">&#x27;trachea_or_lung&#x27;</span>,</span><br><span class="line">                          <span class="string">&#x27;g15f1&#x27;</span>:<span class="string">&#x27;tuberculosis&#x27;</span>,<span class="string">&#x27;g15g1&#x27;</span>:<span class="string">&#x27;cataracts&#x27;</span>,<span class="string">&#x27;g15h1&#x27;</span>:<span class="string">&#x27;glaucoma&#x27;</span>,<span class="string">&#x27;g15i1&#x27;</span>:<span class="string">&#x27;cancer&#x27;</span>,<span class="string">&#x27;g15j1&#x27;</span>:<span class="string">&#x27;prostate&#x27;</span>,<span class="string">&#x27;g15k1&#x27;</span>:<span class="string">&#x27;stomach_ulcer&#x27;</span>,</span><br><span class="line">                          <span class="string">&#x27;g15l1&#x27;</span>:<span class="string">&#x27;Parkinson&#x27;</span>,<span class="string">&#x27;g15m1&#x27;</span>:<span class="string">&#x27;bedsore&#x27;</span>,<span class="string">&#x27;g15n1&#x27;</span>:<span class="string">&#x27;arthritis&#x27;</span>&#125;</span><br><span class="line">    descrptive_vars = var_list + <span class="built_in">list</span>(rename_dict_base.values())</span><br><span class="line">    numerical_vars = [<span class="string">&#x27;depression_score&#x27;</span>,<span class="string">&#x27;tour_times&#x27;</span>]</span><br><span class="line">    var_name = []</span><br><span class="line">    pvalues = []</span><br><span class="line">    <span class="keyword">for</span> var <span class="keyword">in</span> descrptive_vars:</span><br><span class="line">        kf_data = np.array(total_df.groupby([<span class="string">&#x27;later_CI&#x27;</span>,var]).count().iloc[:,<span class="number">0</span>]).reshape(<span class="number">2</span>,<span class="built_in">len</span>(total_df[var].unique()))</span><br><span class="line">        kf = chi2_contingency(kf_data)</span><br><span class="line">        var_name.append(var)</span><br><span class="line">        pvalues.append(kf[<span class="number">1</span>])</span><br><span class="line">    <span class="keyword">for</span> var <span class="keyword">in</span> numerical_vars:</span><br><span class="line">        a = total_df[total_df.later_CI == <span class="number">0</span>][var]</span><br><span class="line">        b = total_df[total_df.later_CI == <span class="number">1</span>][var]</span><br><span class="line">        t_res = ttest_ind(a, b)</span><br><span class="line">        var_name.append(var)</span><br><span class="line">        pvalues.append(t_res.pvalue)</span><br><span class="line">    df_out = pd.DataFrame(&#123;<span class="string">&#x27;Variable&#x27;</span>:var_name,<span class="string">&#x27;p-values&#x27;</span>:pvalues&#125;)</span><br><span class="line">    <span class="keyword">return</span> df_out</span><br></pre></td></tr></table></figure><p>第一部分结束<br>第二部分：<br>先沿用第一部分合并数据成总的df，然后计算三年变量和当年变量的diff差异如以下函数所示：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_current_diff_variable_list</span>(<span class="params">total_df</span>):</span><br><span class="line">    current_variables = []</span><br><span class="line">    later_variables = []</span><br><span class="line">    <span class="keyword">for</span> col <span class="keyword">in</span> total_df.columns:</span><br><span class="line">        <span class="keyword">if</span> col[-<span class="number">12</span>:] == <span class="string">&#x27;3years_later&#x27;</span>:</span><br><span class="line">            <span class="comment">#三年后的变量</span></span><br><span class="line">            later_variables.append(col)</span><br><span class="line">        <span class="keyword">if</span> col[-<span class="number">12</span>:] != <span class="string">&#x27;3years_later&#x27;</span>:</span><br><span class="line">            <span class="comment">#当前的变量</span></span><br><span class="line">            current_variables.append(col)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> var <span class="keyword">in</span> [<span class="string">&#x27;current_CI_score&#x27;</span>,</span><br><span class="line">                 <span class="string">&#x27;later_CI_score&#x27;</span>,</span><br><span class="line">                 <span class="string">&#x27;current_CI&#x27;</span>,</span><br><span class="line">                 <span class="string">&#x27;later_CI&#x27;</span>,</span><br><span class="line">                 <span class="string">&#x27;depression_score_later&#x27;</span>,</span><br><span class="line">                 <span class="string">&#x27;ADL_later&#x27;</span>,</span><br><span class="line">                 <span class="string">&#x27;CI_diff&#x27;</span></span><br><span class="line">                 ]:</span><br><span class="line">        current_variables.remove(var)</span><br><span class="line"></span><br><span class="line">    later_variables.extend([<span class="string">&#x27;ADL_later&#x27;</span>,<span class="string">&#x27;depression_score_later&#x27;</span>])</span><br><span class="line">    person_basic_variables = [<span class="string">&#x27;gender&#x27;</span>,<span class="string">&#x27;residence&#x27;</span>,<span class="string">&#x27;education&#x27;</span>,<span class="string">&#x27;borned_prov&#x27;</span>,<span class="string">&#x27;nation_group&#x27;</span>]</span><br><span class="line"></span><br><span class="line">    current_variables_without_personal = current_variables.copy()</span><br><span class="line">    <span class="comment">#移除个人信息【初始值】</span></span><br><span class="line">    <span class="keyword">for</span> var <span class="keyword">in</span> person_basic_variables:</span><br><span class="line">        current_variables_without_personal.remove(var)</span><br><span class="line"></span><br><span class="line">    current_variables_without_personal.sort()</span><br><span class="line">    later_variables.sort()</span><br><span class="line">    <span class="comment">#计算差异</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Creating diff variables based on current variables and 3 years later variables ...&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> x,y <span class="keyword">in</span> <span class="built_in">zip</span>(current_variables_without_personal,later_variables):</span><br><span class="line">        total_df[x+<span class="string">&#x27;_diff&#x27;</span>] = total_df[y] - total_df[x]</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Done!&#x27;</span>)</span><br><span class="line">        </span><br><span class="line">    diff_var = <span class="built_in">list</span>(<span class="built_in">map</span>(<span class="keyword">lambda</span> x:x+<span class="string">&#x27;_diff&#x27;</span>,current_variables_without_personal))</span><br><span class="line">    current_variables.remove(<span class="string">&#x27;dementia&#x27;</span>)</span><br><span class="line">    diff_var.remove(<span class="string">&#x27;dementia_diff&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> current_variables,diff_var</span><br></pre></td></tr></table></figure><p>然后调用逻辑回归,这里调用的是model = sm.Logit(y,x.astype(float)).fit()应该是个库与先前教程中的是不同的是有点复杂的以后有做这方面研究的话可以看，这里其实是用了多重线性回归。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">total_df_for_logit = total_df.copy()</span><br><span class="line"><span class="keyword">for</span> col <span class="keyword">in</span> total_df_for_logit.columns:</span><br><span class="line">    total_df_for_logit[col] = pd.to_numeric(total_df_for_logit[col],downcast=<span class="string">&#x27;float&#x27;</span>)</span><br></pre></td></tr></table></figure><p>具体逻辑回归函数</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">logistic_regression</span>(<span class="params">input_df,label_column,categorical_variable_list=[],CI_alpha=<span class="number">0.05</span>,standardized_diff = <span class="literal">False</span></span>):</span><br><span class="line">    df = input_df.copy()</span><br><span class="line">    <span class="keyword">if</span> standardized_diff:</span><br><span class="line">        diff_var = <span class="built_in">list</span>(<span class="built_in">filter</span>(<span class="keyword">lambda</span> x:<span class="literal">True</span> <span class="keyword">if</span> x[-<span class="number">4</span>:] == <span class="string">&#x27;diff&#x27;</span> <span class="keyword">else</span> <span class="literal">False</span>,df.columns))</span><br><span class="line">        <span class="keyword">if</span> diff_var:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;Standardizing diff variables ...&#x27;</span>)</span><br><span class="line">            <span class="keyword">for</span> var <span class="keyword">in</span> diff_var:</span><br><span class="line">                df[var] = df[var].apply(<span class="keyword">lambda</span> x:x <span class="keyword">if</span> x&lt;= <span class="number">0</span> <span class="keyword">else</span> <span class="number">1</span>)</span><br><span class="line">                df[var] = df[var].apply(<span class="keyword">lambda</span> x:x <span class="keyword">if</span> x&gt;=<span class="number">0</span> <span class="keyword">else</span> -<span class="number">1</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;Standardize diff variables done!&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 一起逻辑回归</span></span><br><span class="line">    x_col = [column <span class="keyword">for</span> column <span class="keyword">in</span> df.columns <span class="keyword">if</span> label_column <span class="keyword">not</span> <span class="keyword">in</span> column <span class="keyword">and</span> column <span class="keyword">not</span> <span class="keyword">in</span> categorical_variable_list]</span><br><span class="line">    y_col = [column <span class="keyword">for</span> column <span class="keyword">in</span> df.columns <span class="keyword">if</span> column == label_column]</span><br><span class="line">    <span class="comment"># </span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;borned_prov&#x27;</span> <span class="keyword">in</span> x_col:x_col.remove(<span class="string">&#x27;borned_prov&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;agegroup_3years_later&#x27;</span> <span class="keyword">in</span> x_col:x_col.remove(<span class="string">&#x27;agegroup_3years_later&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;agegroup_diff&#x27;</span> <span class="keyword">in</span> x_col:x_col.remove(<span class="string">&#x27;agegroup_diff&#x27;</span>)</span><br><span class="line"> </span><br><span class="line">    x = np.array(df[x_col])</span><br><span class="line">    <span class="keyword">if</span> categorical_variable_list:</span><br><span class="line">        onehot_cat_var = pd.get_dummies(df[categorical_variable_list[<span class="number">0</span>]],prefix = categorical_variable_list[<span class="number">0</span>])</span><br><span class="line">        drop_ref_col = <span class="built_in">list</span>(<span class="built_in">filter</span>(<span class="keyword">lambda</span> x:<span class="literal">True</span> <span class="keyword">if</span> x[-<span class="number">2</span>:] == <span class="string">&#x27;_0&#x27;</span> <span class="keyword">or</span> x[-<span class="number">4</span>:] == <span class="string">&#x27;_0.0&#x27;</span> <span class="keyword">else</span> <span class="literal">False</span>,onehot_cat_var.columns))</span><br><span class="line">        onehot_cat_var.drop(drop_ref_col,axis = <span class="number">1</span>,inplace = <span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">for</span> variable <span class="keyword">in</span> categorical_variable_list[<span class="number">1</span>:]:</span><br><span class="line">            tmp = pd.get_dummies(df[variable],prefix = variable)</span><br><span class="line">            drop_ref_col = <span class="built_in">list</span>(<span class="built_in">filter</span>(<span class="keyword">lambda</span> x:<span class="literal">True</span> <span class="keyword">if</span> x[-<span class="number">2</span>:] == <span class="string">&#x27;_0&#x27;</span> <span class="keyword">or</span> x[-<span class="number">4</span>:] == <span class="string">&#x27;_0.0&#x27;</span> <span class="keyword">else</span> <span class="literal">False</span>,tmp.columns))</span><br><span class="line">            tmp.drop(drop_ref_col,axis = <span class="number">1</span>,inplace = <span class="literal">True</span>)</span><br><span class="line">            onehot_cat_var = pd.concat([onehot_cat_var,tmp],axis = <span class="number">1</span>)</span><br><span class="line">        onehot_cat_var_values = np.array(onehot_cat_var)</span><br><span class="line">        x = np.hstack([x,onehot_cat_var_values])</span><br><span class="line">    y = np.array(df[label_column].astype(<span class="built_in">float</span>)).reshape(-<span class="number">1</span>)</span><br><span class="line">    model = sm.Logit(y,x.astype(<span class="built_in">float</span>)).fit()</span><br><span class="line">    para = pd.DataFrame(np.exp(model.conf_int(CI_alpha)),columns = [<span class="string">&#x27;95%lower&#x27;</span>,<span class="string">&#x27;95%upper&#x27;</span>])</span><br><span class="line">    para[<span class="string">&#x27;coef&#x27;</span>] = model.params</span><br><span class="line">    para[<span class="string">&#x27;OddRatio&#x27;</span>] = np.exp(para.coef)</span><br><span class="line">    x_name = x_col.copy()</span><br><span class="line">    <span class="keyword">if</span> categorical_variable_list:</span><br><span class="line">        x_name.extend(onehot_cat_var.columns)</span><br><span class="line">    para[<span class="string">&#x27;Variable&#x27;</span>] = x_name</span><br><span class="line">    para[<span class="string">&#x27;pvalues&#x27;</span>] = model.pvalues</span><br><span class="line"></span><br><span class="line">    var_value_count = []</span><br><span class="line">    <span class="keyword">for</span> vari <span class="keyword">in</span> x_name:</span><br><span class="line">        <span class="keyword">if</span> vari[-<span class="number">1</span>] == <span class="string">&#x27;0&#x27;</span>:</span><br><span class="line">            <span class="keyword">if</span> vari[-<span class="number">4</span>] == <span class="string">&#x27;-&#x27;</span>:</span><br><span class="line">                var_value = <span class="built_in">float</span>(vari[-<span class="number">4</span>:])</span><br><span class="line">                var_name = vari[:-<span class="number">5</span>]</span><br><span class="line">                <span class="built_in">print</span>(vari)</span><br><span class="line">                var_value_count.append(<span class="built_in">len</span>(df[df[var_name]==var_value]))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                var_value = <span class="built_in">float</span>(vari[-<span class="number">3</span>:])</span><br><span class="line">                var_name = vari[:-<span class="number">4</span>]</span><br><span class="line">                var_value_count.append(<span class="built_in">len</span>(df[df[var_name]==var_value]))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            var_value_count.append(<span class="built_in">len</span>(df[df[vari]==<span class="number">1</span>]))</span><br><span class="line">    para[<span class="string">&#x27;Num of samples&#x27;</span>] = var_value_count</span><br><span class="line">    para = para[[<span class="string">&#x27;Variable&#x27;</span>,<span class="string">&#x27;Num of samples&#x27;</span>,<span class="string">&#x27;coef&#x27;</span>,<span class="string">&#x27;OddRatio&#x27;</span>,<span class="string">&#x27;95%lower&#x27;</span>,<span class="string">&#x27;95%upper&#x27;</span>,<span class="string">&#x27;pvalues&#x27;</span>]]</span><br><span class="line">    std_x = np.array((df[x_col]-np.mean(df[x_col]))/np.std(df[x_col]))</span><br><span class="line">    <span class="keyword">if</span> categorical_variable_list:</span><br><span class="line">        std_x = np.hstack([std_x,onehot_cat_var_values])</span><br><span class="line">    model2 = sm.Logit(y,std_x.astype(<span class="built_in">float</span>)).fit()</span><br><span class="line">    importance_df = pd.DataFrame(para[<span class="string">&#x27;Variable&#x27;</span>])</span><br><span class="line">    importance_df[<span class="string">&#x27;coef&#x27;</span>] = model2.params</span><br><span class="line">    importance_df.sort_values(by = <span class="string">&#x27;coef&#x27;</span>,ascending=<span class="literal">False</span>,key=np.<span class="built_in">abs</span>,inplace = <span class="literal">True</span>)</span><br><span class="line">    importance_df[<span class="string">&#x27;importance&#x27;</span>] = <span class="built_in">range</span>(<span class="number">1</span>,<span class="built_in">len</span>(importance_df)+<span class="number">1</span>)</span><br><span class="line">    importance_df.drop(<span class="string">&#x27;coef&#x27;</span>,axis=<span class="number">1</span>,inplace=<span class="literal">True</span>)</span><br><span class="line">    importance_df.set_index(<span class="string">&#x27;importance&#x27;</span>,inplace = <span class="literal">True</span>)</span><br><span class="line">    </span><br><span class="line"><span class="comment">#     # 单个变量回归</span></span><br><span class="line"><span class="comment">#     single_para = pd.DataFrame(columns = [&#x27;Variable&#x27;,&#x27;solo_coef&#x27;,&#x27;solo_OddRatio&#x27;,&#x27;solo_95%lower&#x27;,&#x27;solo_95%upper&#x27;,&#x27;solo_pvalues&#x27;])</span></span><br><span class="line"><span class="comment">#     for j in range(x.shape[1]):</span></span><br><span class="line"><span class="comment">#         single_x = x[:,j]</span></span><br><span class="line"><span class="comment">#         variable = x_name[j]</span></span><br><span class="line"><span class="comment">#         single_model = sm.Logit(y,single_x.astype(float)).fit()</span></span><br><span class="line"><span class="comment">#         solo_coef = single_model.params</span></span><br><span class="line"><span class="comment">#         solo_OR = np.exp(single_model.params)</span></span><br><span class="line"><span class="comment">#         solo_lower = np.exp(single_model.conf_int(CI_alpha)[0][0])</span></span><br><span class="line"><span class="comment">#         solo_upper = np.exp(single_model.conf_int(CI_alpha)[0][1])</span></span><br><span class="line"><span class="comment">#         solo_pvalue = single_model.pvalues</span></span><br><span class="line"><span class="comment">#         temp = pd.DataFrame(&#123;&#x27;Variable&#x27;:variable,&#x27;solo_coef&#x27;:solo_coef,&#x27;solo_OddRatio&#x27;:solo_OR,&#x27;solo_95%lower&#x27;:solo_lower,&#x27;solo_95%upper&#x27;:solo_upper,&#x27;solo_pvalues&#x27;:solo_pvalue&#125;)</span></span><br><span class="line"><span class="comment">#         single_para = pd.concat([single_para,temp],axis = 0)</span></span><br><span class="line"><span class="comment">#     para = pd.merge(para,single_para,on = &#x27;Variable&#x27;)  </span></span><br><span class="line">                                </span><br><span class="line">    res = &#123;<span class="string">&#x27;summary&#x27;</span>:model.summary(),</span><br><span class="line">       <span class="string">&#x27;params&#x27;</span>:para,</span><br><span class="line">       <span class="string">&#x27;feature_importance&#x27;</span>:importance_df&#125;</span><br><span class="line">    <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure><p>在上一步逻辑回归中计算了百分之95置信区间此处用在OR()中，OR值是《流行病学》中的重要概念，称作“优势比”（odds ratio），也称“比值比”，反映的是某种暴露与结局的关联强度。<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/243312136">逻辑回归和OR值</a>,所谓研究“暴露对结局”的影响，这里的“结局”在本例中就指“是否患有糖尿病”，一般可以等同于我们前面说的“因变量Y”。<br>所谓的“优势”可以理解为“暴露比值”！那怎么理解暴露比值呢？<br>在本例中，对于患有糖尿病的对象，暴露比值为：吸烟的比例除以不吸烟的比例，即为：24/16 = 1.50；<br>同样，在不患有糖尿病的人群中，也可以计算一个吸烟的比例除以不吸烟的比例，即为：18/22 = 0.82。<br>把这两个比例相除，就得到了吸烟与糖尿病相关关系的OR值，即OR = 1.50/0.82= 1.83&gt;1,说明是比较相关的也是一个分析相关性的数据，p值可能更多的是分析差异性【重要但本代码中的OR值还要结合逻辑回归代码比较是用逻辑回归模型估计比值比（OR）和 95% 置信区间 （CI），本文的OR小于1是降低了认知障碍发生的风险。】</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">get_OR</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">str</span>(<span class="string">&#x27;%.2f&#x27;</span> %x[<span class="string">&#x27;OddRatio&#x27;</span>])+<span class="string">&#x27;(&#x27;</span>+<span class="built_in">str</span>(<span class="string">&#x27;%.2f&#x27;</span> %x[<span class="string">&#x27;95%lower&#x27;</span>]) +<span class="string">&#x27;,&#x27;</span>+<span class="built_in">str</span>(<span class="string">&#x27;%.2f&#x27;</span> %x[<span class="string">&#x27;95%upper&#x27;</span>]) + <span class="string">&#x27;)&#x27;</span></span><br></pre></td></tr></table></figure><p>本代码还计算了差异的相关性</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">output2.loc[<span class="built_in">list</span>(<span class="built_in">set</span>(output2.index)-<span class="built_in">set</span>(output1.Variable)),:].sort_values(by = <span class="string">&#x27;Variable&#x27;</span>)</span><br></pre></td></tr></table></figure><p>筛选出p值小于0.05的差异变量</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">significant_pos_diff = output2.loc[diff_variables_pos,:].query(<span class="string">&#x27;pvalues&lt;0.05&#x27;</span>)</span><br><span class="line">significant_pos_diff</span><br></pre></td></tr></table></figure><p>后面还需要以后研究</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">need_divide_diff = <span class="built_in">list</span>(<span class="built_in">map</span>(<span class="keyword">lambda</span> x:x[:-<span class="number">4</span>],<span class="built_in">list</span>(significant_pos_diff.index)))</span><br><span class="line"><span class="keyword">if</span> <span class="string">&#x27;exercise_diff&#x27;</span> <span class="keyword">in</span> need_divide_diff:</span><br><span class="line">    need_divide_diff.remove(<span class="string">&#x27;exercise_diff&#x27;</span>)</span><br></pre></td></tr></table></figure><p>最后本文为比较了各种算法的结果包括SVM最后比较了他们的准确性等指标，这篇文章还分析了纵向行为变化与认知障碍之间关联</p></article><div class="post-copyright"><div class="post-copyright__title"><span class="post-copyright-info"><h>使用机器学习算法预测中国老年人的认知障碍并识别可改变的因素阅读</h></span></div><div class="post-copyright__type"><span class="post-copyright-info"><a href="https://www.hgez6.top/posts/bb223095/">https://www.hgez6.top/posts/bb223095/</a></span></div><div class="post-copyright-m"><div class="post-copyright-m-info"><div class="post-copyright-a"><h>作者</h><div class="post-copyright-cc-info"><h>本大鸟就是玩✈️~</h></div></div><div class="post-copyright-c"><h>发布于</h><div class="post-copyright-cc-info"><h>2023-11-15</h></div></div><div class="post-copyright-u"><h>更新于</h><div class="post-copyright-cc-info"><h>2024-01-22</h></div></div><div class="post-copyright-c"><h>许可协议</h><div class="post-copyright-cc-info"><a class="icon" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a><a rel="noopener" target="_blank" title="CC BY-NC-SA 4.0" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a></div></div></div></div></div><div class="business-center"><div class="business-card"><div class="business-flip"><div class="business-front"><div class="business-strip-bottom"></div><div class="business-strip-top"></div><img class="business-logo" width="80" height="80" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://pic2.zhimg.com/50/v2-debb46ef731baa386482f9cddc7cbc21_720w.webp?source=1940ef5c" alt="cardcode"><div class="business-Invitation">Invitation</div><div class="business-chip"><div class="business-chip-line"></div><div class="business-chip-line"></div><div class="business-chip-line"></div><div class="business-chip-line"></div><div class="business-chip-main"></div></div><svg class="business-wave" viewBox="0 3.71 26.959 38.787" width="26.959" height="38.787" fill="white"><path d="M19.709 3.719c.266.043.5.187.656.406 4.125 5.207 6.594 11.781 6.594 18.938 0 7.156-2.469 13.73-6.594 18.937-.195.336-.57.531-.957.492a.9946.9946 0 0 1-.851-.66c-.129-.367-.035-.777.246-1.051 3.855-4.867 6.156-11.023 6.156-17.718 0-6.696-2.301-12.852-6.156-17.719-.262-.317-.301-.762-.102-1.121.204-.36.602-.559 1.008-.504z"></path><path d="M13.74 7.563c.231.039.442.164.594.343 3.508 4.059 5.625 9.371 5.625 15.157 0 5.785-2.113 11.097-5.625 15.156-.363.422-1 .472-1.422.109-.422-.363-.472-1-.109-1.422 3.211-3.711 5.156-8.551 5.156-13.843 0-5.293-1.949-10.133-5.156-13.844-.27-.309-.324-.75-.141-1.114.188-.367.578-.582.985-.542h.093z"></path><path d="M7.584 11.438c.227.031.438.144.594.312 2.953 2.863 4.781 6.875 4.781 11.313 0 4.433-1.828 8.449-4.781 11.312-.398.387-1.035.383-1.422-.016-.387-.398-.383-1.035.016-1.421 2.582-2.504 4.187-5.993 4.187-9.875 0-3.883-1.605-7.372-4.187-9.875-.321-.282-.426-.739-.266-1.133.164-.395.559-.641.984-.617h.094zM1.178 15.531c.121.02.238.063.344.125 2.633 1.414 4.437 4.215 4.437 7.407 0 3.195-1.797 5.996-4.437 7.406-.492.258-1.102.07-1.36-.422-.257-.492-.07-1.102.422-1.359 2.012-1.075 3.375-3.176 3.375-5.625 0-2.446-1.371-4.551-3.375-5.625-.441-.204-.676-.692-.551-1.165.122-.468.567-.785 1.051-.742h.094z"></path></svg><div class="business-card-number"><div class="business-section">hgez6</div><div class="business-section">666666</div></div><div class="business-end"><span class="business-end-text">created:</span><span class="business-end-date">14/10/2022</span></div><div class="business-card-holder">Big Bird Luck Card</div><div class="business-master"><div class="business-circle business-master-red"></div><div class="business-circle business-master-yellow"></div></div></div><div class="business-back"><div class="business-strip-black"></div><div class="business-ccv"><label>鸟哥幸运卡</label><div><a target="_blank" rel="noopener" href="https://hgez6.top/">https://hgez6.top/</a></div></div><div class="business-terms"><p>Be happy .</p><p>This is luck card,wish you a nice day .</p></div></div></div></div></div><div class="tag_share"><div class="post-meta__tag-list"></div></div><link rel="stylesheet" href="/css/coin.css" media="defer" onload='this.media="all"'><div class="post-reward"><button class="tip-button reward-button"><span class="tip-button__text">投喂作者</span><div class="coin-wrapper"><div class="coin"><div class="coin__middle"></div><div class="coin__back"></div><div class="coin__front"></div></div></div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://pic1.zhimg.com/50/v2-37fc665d11aad76118a540e75498b5be_720w.webp?source=1940ef5c" target="_blank"><img class="post-qr-code-img" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://pic1.zhimg.com/50/v2-37fc665d11aad76118a540e75498b5be_720w.webp?source=1940ef5c" alt="Win!"></a><div class="post-qr-code-desc">Win!</div></li><li class="reward-item"><a href="https://pica.zhimg.com/50/v2-4a96a9401ec6f93f232a7bc5a72a072d_720w.webp?source=1940ef5c" target="_blank"><img class="post-qr-code-img" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://pica.zhimg.com/50/v2-4a96a9401ec6f93f232a7bc5a72a072d_720w.webp?source=1940ef5c" alt="666~"></a><div class="post-qr-code-desc">666~</div></li></ul></div></button></div><audio id="coinAudio" src="https://yun.hgez6.top/api/raw/?path=/picbed/audio/aowu.m4a"></audio><script defer src="/js/coin.js"></script><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/d5bdee9a/"><img class="prev-cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://yun.hgez6.top/api/raw/?path=/picbed/21.jpg" onerror='onerror=null,src="/assets/r2.jpg"' alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">甲磺酸73浓度siler分析</div></div></a></div><div class="next-post pull-right"><a href="/posts/1ed1c48a/"><img class="next-cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://yun.hgez6.top/api/raw/?path=/picbed/1.jpg" onerror='onerror=null,src="/assets/r2.jpg"' alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">工程矩阵笔记</div></div></a></div></nav><hr><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i> <span>评论</span></div></div><div class="comment-wrap"><div><div id="gitalk-container"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><svg class="meta_icon" style="width:22px;height:22px;position:relative;top:5px"><use xlink:href="#icon-mulu1"></use></svg><span style="font-weight:700">目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8E%9F%E6%96%87%E9%93%BE%E6%8E%A5"><span class="toc-text">原文链接</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%8D%E7%8E%B0"><span class="toc-text">复现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E9%A2%84%E5%A4%84%E7%90%86%E6%80%BB%E8%BF%B0"><span class="toc-text">数据预处理总述</span></a></li></ol></li></ol></li></ol></div></div></div></div></main><footer id="footer" style="background-color:transparent"><div id="footer-wrap"><div id="ft"><div class="ft-item-1"><div class="t-top"><div class="t-t-l"><p class="ft-t t-l-t">格言🧬</p><div class="bg-ad"><div>再看看那个光点，它就在这里，这是家园，这是我们 —— 你所爱的每一个人，你认识的一个人，你听说过的每一个人，曾经有过的每一个人，都在它上面度过他们的一生✨</div><div class="btn-xz-box"><a class="btn-xz" target="_blank" rel="noopener" href="https://stellarium.org/">点击开启星辰之旅</a></div></div></div><div class="t-t-r"><p class="ft-t t-l-t">猜你想看💡</p><ul class="ft-links"><li><a href="/posts/eec9786.html">魔改指南</a><a href="/box/nav/">网址导航</a></li><li><a href="/social/link/">我的朋友</a><a href="/comments/">留点什么</a></li><li><a href="/about/">关于作者</a><a href="/archives/">文章归档</a></li><li><a href="/categories/">文章分类</a><a href="/tags/">文章标签</a></li><li><a href="/mypicture/">我的相册</a><a href="/personal/bb/">我的唠叨</a></li><li><a href="/aboutweb/">关于本站</a><a href="/site/census/">网站统计</a></li></ul></div></div></div><div class="ft-item-2"><p class="ft-t">推荐友链⌛</p><div class="ft-img-group"><div class="img-group-item"><a target="_blank" rel="noopener" href="https://www.fomal.cc/" title="Fomalhaut🥝"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://lskypro.acozycotage.net/LightPicture/2022/12/60e5d4e39da7c077.webp" alt=""></a></div><div class="img-group-item"><a href="javascript:void(0)" title="广告位招租"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://lskypro.acozycotage.net/LightPicture/2022/12/65307a5828af6790.webp" alt=""></a></div><div class="img-group-item"><a href="javascript:void(0)" title="广告位招租"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://lskypro.acozycotage.net/LightPicture/2022/12/65307a5828af6790.webp" alt=""></a></div><div class="img-group-item"><a href="javascript:void(0)" title="广告位招租"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://lskypro.acozycotage.net/LightPicture/2022/12/65307a5828af6790.webp" alt=""></a></div><div class="img-group-item"><a href="javascript:void(0)" title="广告位招租"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://lskypro.acozycotage.net/LightPicture/2022/12/65307a5828af6790.webp" alt=""></a></div><div class="img-group-item"><a href="javascript:void(0)" title="广告位招租"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://lskypro.acozycotage.net/LightPicture/2022/12/65307a5828af6790.webp" alt=""></a></div><div class="img-group-item"><a href="javascript:void(0)" title="广告位招租"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://lskypro.acozycotage.net/LightPicture/2022/12/65307a5828af6790.webp" alt=""></a></div><div class="img-group-item"><a href="javascript:void(0)" title="广告位招租"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://lskypro.acozycotage.net/LightPicture/2022/12/65307a5828af6790.webp" alt=""></a></div></div></div></div><div class="copyright"><span><b>&copy;2021-2024</b></span><span><b>&nbsp;&nbsp;By 本大鸟就是玩✈️~</b></span></div><div id="workboard"></div><p id="ghbdages"><a class="github-badge" target="_blank" href="https://hgez6.top/" style="margin-inline:5px" title="作者为hgez6"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/badge/auther-hgez6-blueviolet.svg" alt=""></a><a class="github-badge" target="_blank" href="https://butterfly.js.org/" style="margin-inline:5px" title="主题版本Butterfly_v4.3.1"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/badge/Theme-Butterfly-6513df.svg" alt=""></a><a class="github-badge" target="_blank" href="https://cn.bing.com/" style="margin-inline:5px" title="SEO 支持-Bing"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/badge/SEO-bing-important.svg" alt=""></a><a class="github-badge" target="_blank" href="https://tongji.baidu.com/web/welcome/login" style="margin-inline:5px" title="统计支持-百度统计"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/badge/analysis-Baidu-green.svg" alt=""></a><a class="github-badge" target="_blank" href="https://icp.gov.moe/" style="margin-inline:5px" title="本站已加入萌ICP豪华套餐，萌ICP备20226066号"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/badge/MICP.svg" alt=""></a><a class="github-badge" target="_blank" href="https://hgez6.top/aboutweb/" style="margin-inline:5px" title="使用模块化部署技术可整合多种前端框架"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=" /img/badge/Technology-Modularization-ff96b4.svg" alt=""></a><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" title="博客框架为Hexo"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/badge/Frame-Hexo-blue.svg" alt=""></a><a class="github-badge" target="_blank" href="https://github.com/" style="margin-inline:5px" title="本网站源码由Github提供存储仓库"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/badge/Page-Github-1586be.svg" alt=""></a></p></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><a class="icon-V hidden" onclick="switchNightMode()" title="浅色和深色模式转换"><svg width="25" height="25" viewBox="0 0 1024 1024"><use id="modeicon" xlink:href="#icon-moon"></use></svg></a><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button><button class="share" type="button" title="右键模式" onclick="changeMouseMode()"><i class="fas fa-mouse"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog right_side"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button class="share" type="button" title="分享链接" onclick="share()"><i class="fas fa-share-nodes"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i><span id="percent">0<span>%</span></span></button><button id="go-down" type="button" title="直达底部" onclick="btf.scrollToDest(document.body.scrollHeight,500)"><i class="fas fa-arrow-down"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i> <span>数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"></div></div><hr><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div class="js-pjax" id="rightMenu"><div class="rightMenu-group rightMenu-small"><a class="rightMenu-item" href="javascript:window.history.back();"><i class="fa fa-arrow-left"></i></a><a class="rightMenu-item" href="javascript:window.history.forward();"><i class="fa fa-arrow-right"></i></a><a class="rightMenu-item" href="javascript:window.location.reload();"><i class="fa fa-refresh"></i></a><a class="rightMenu-item" href="javascript:rmf.scrollToTop();"><i class="fa fa-arrow-up"></i></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-text"><a class="rightMenu-item" href="javascript:rmf.copySelect();"><i class="fa fa-copy"></i><span>复制</span></a><a class="rightMenu-item" href="javascript:window.open(&quot;https://www.baidu.com/s?wd=&quot;+window.getSelection().toString());window.location.reload();"><i class="fa fa-search"></i><span>百度搜索</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-too"><a class="rightMenu-item" href="javascript:window.open(window.getSelection().toString());window.location.reload();"><i class="fa fa-link"></i><span>转到链接</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-paste"><a class="rightMenu-item" href="javascript:rmf.paste()"><i class="fa fa-copy"></i><span>粘贴</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-post"><a class="rightMenu-item" href="#post-comment"><i class="fas fa-comment"></i><span>空降评论</span></a><a class="rightMenu-item" href="javascript:rmf.copyWordsLink()"><i class="fa fa-link"></i><span>复制本文地址</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-to"><a class="rightMenu-item" href="javascript:rmf.openWithNewTab()"><i class="fa fa-window-restore"></i><span>新窗口打开</span></a><a class="rightMenu-item" id="menu-too" href="javascript:rmf.open()"><i class="fa fa-link"></i><span>转到链接</span></a><a class="rightMenu-item" href="javascript:rmf.copyLink()"><i class="fa fa-copy"></i><span>复制链接</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-img"><a class="rightMenu-item" href="javascript:rmf.saveAs()"><i class="fa fa-download"></i><span>保存图片</span></a><a class="rightMenu-item" href="javascript:rmf.openWithNewTab()"><i class="fa fa-window-restore"></i><span>在新窗口打开</span></a><a class="rightMenu-item" href="javascript:rmf.copyLink()"><i class="fa fa-copy"></i><span>复制图片链接</span></a></div><div class="rightMenu-group rightMenu-line"><a class="rightMenu-item" href="javascript:randomPost()"><i class="fa fa-paper-plane"></i><span>随便逛逛</span></a><a class="rightMenu-item" href="javascript:switchNightMode();"><i class="fa fa-moon"></i><span>昼夜切换</span></a><a class="rightMenu-item" href="javascript:rmf.switchReadMode();"><i class="fa fa-book"></i><span>阅读模式</span></a><a class="rightMenu-item" href="/personal/about/"><i class="fa fa-info-circle"></i><span>关于博客</span></a><a class="rightMenu-item" href="javascript:toggleWinbox();"><i class="fas fa-cog"></i><span>美化设置</span></a><a class="rightMenu-item" href="javascript:rmf.fullScreen();"><i class="fas fa-expand"></i><span>切换全屏</span></a><a class="rightMenu-item" href="javascript:window.print();"><i class="fa-solid fa-print"></i><span>打印页面</span></a></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.staticfile.org/fancyapps-ui/4.0.31/fancybox.umd.min.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/instant.page/5.1.0/instantpage.min.js" type="module"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/vanilla-lazyload/17.3.1/lazyload.iife.min.js"></script><script src="/js/search/local-search.js"></script><script async>var preloader={endLoading:()=>{document.body.style.overflow="auto",document.getElementById("loading-box").classList.add("loaded")},initLoading:()=>{document.body.style.overflow="",document.getElementById("loading-box").classList.remove("loaded")}};window.addEventListener("load",preloader.endLoading()),setTimeout((function(){preloader.endLoading()}),5e3),document.getElementById("loading-box").addEventListener("click",(()=>{preloader.endLoading()}))</script><div class="js-pjax"><script>if(window.MathJax)MathJax.startup.document.state(0),MathJax.texReset(),MathJax.typeset();else{window.MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]],tags:"ams"},chtml:{scale:1.2},options:{renderActions:{findScript:[10,t=>{for(const e of document.querySelectorAll('script[type^="math/tex"]')){const a=!!e.type.match(/; *mode=display/),n=new t.options.MathItem(e.textContent,t.inputJax[0],a),s=document.createTextNode("");e.parentNode.replaceChild(s,e),n.start={node:s,delim:"",n:0},n.end={node:s,delim:"",n:0},t.math.push(n)}},""],insertScript:[200,()=>{document.querySelectorAll("mjx-container:not([display])").forEach((t=>{const e=t.parentNode;"li"===e.nodeName.toLowerCase()?e.parentNode.classList.add("has-jax"):e.classList.add("has-jax")}))},"",!1]}}};const t=document.createElement("script");t.src="/pluginsSrc/mathjax/es5/tex-mml-chtml.js",t.id="MathJax-script",t.async=!0,document.head.appendChild(t)}</script><script>function addGitalkSource(){const t=document.createElement("link");t.rel="stylesheet",t.href="/pluginsSrc/gitalk/dist/gitalk.css",document.getElementsByTagName("head")[0].appendChild(t)}function loadGitalk(){function t(){new Gitalk(Object.assign({clientID:"df0b9c9de6d72825d4e1",clientSecret:"45cca8da59c6a1b17cb0fa0c02267b31a2b21df1",repo:"hgez6.github.io",owner:"hgez6",admin:["hgez6"],id:"9354ea54c4764b7243f808e7d6424e70",updateCountCallback:commentCount},null)).render("gitalk-container")}"function"==typeof Gitalk?t():(addGitalkSource(),getScript("/pluginsSrc/gitalk/dist/gitalk.min.js").then(t))}function commentCount(t){let e=document.querySelector("#post-meta .gitalk-comment-count");e&&(e.innerHTML=t)}{function loadOtherComment(){loadGitalk()}btf.loadComment(document.getElementById("gitalk-container"),loadGitalk)}</script></div><script src="/js/chajian/jquery.min.js"></script><script async src="https://cdn1.tianli0.top/npm/vue@2.6.14/dist/vue.min.js"></script><script async src="https://cdn1.tianli0.top/npm/element-ui@2.15.6/lib/index.js"></script><script async src="/js/chajian/clipboard.min.js"></script><script defer src="/js/chajian/sweetalert2.all.js"></script><script async src="/js/chajian/pace.min.js"></script><script defer src="/js/chajian/winbox.bundle.min.js"></script><script async src="//at.alicdn.com/t/c/font_3586335_hsivh70x0fm.js"></script><script async src="//at.alicdn.com/t/c/font_3636804_gr02jmjr3y9.js"></script><script async src="//at.alicdn.com/t/c/font_3612150_kfv55xn3u2g.js"></script><script async src="/js/chajian/Gold-ingot.js"></script><canvas id="universe"></canvas><canvas id="snow"></canvas><script defer src="/js/fomal.js"></script><div class="aplayer no-destroy" data-id="2084738832" data-server="netease" data-type="playlist" data-fixed="true" data-mini="true" data-listfolded="false" data-order="random" data-preload="none" data-autoplay="false" data-title="false" data-lrctype="1" muted></div><script async src="//at.alicdn.com/t/font_3148439_cfvkyebna8.js"></script><script async src="//at.alicdn.com/t/c/font_3148439_fsiy1xlmgzj.js"></script><script async src="//at.alicdn.com/t/font_2264842_3izu8i5eoc2.js"></script><script src="https://widget.qweather.net/simple/static/js/he-simple-common.js?v=2.0"></script><script async data-pjax src="/js/diytianq.js"></script><script src="/js/chajian/echarts.min.js"></script><link rel="stylesheet" href="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/aplayer/1.10.1/APlayer.min.css" media="print" onload='this.media="all"'><script src="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/aplayer/1.10.1/APlayer.min.js"></script><script src="https://cdn1.tianli0.top/npm/js-heo@1.0.12/metingjs/Meting.min.js"></script><script src="https://lib.baomitu.com/pjax/0.2.8/pjax.min.js"></script><script>let pjaxSelectors=["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show","#web_bg",".js-pjax","#bibi","body > title","#app","#tag-echarts","#posts-echart","#categories-echarts"];var pjax=new Pjax({elements:'a:not([target="_blank"]):not([href="/music/"])',selectors:pjaxSelectors,cacheBust:!1,analytics:!1,scrollRestoration:!1});document.addEventListener("pjax:send",(function(){if(window.tocScrollFn&&window.removeEventListener("scroll",window.tocScrollFn),window.scrollCollect&&window.removeEventListener("scroll",scrollCollect),"object"==typeof preloader&&preloader.initLoading(),document.getElementById("rightside").style.cssText="opacity: ''; transform: ''",window.aplayers)for(let e=0;e<window.aplayers.length;e++)window.aplayers[e].options.fixed||window.aplayers[e].destroy();"object"==typeof typed&&typed.destroy();const e=document.body.classList;e.contains("read-mode")&&e.remove("read-mode"),"object"==typeof disqusjs&&disqusjs.destroy()})),document.addEventListener("pjax:complete",(function(){window.refreshFn(),document.querySelectorAll("script[data-pjax]").forEach((e=>{const t=document.createElement("script"),o=e.text||e.textContent||e.innerHTML||"";Array.from(e.attributes).forEach((e=>t.setAttribute(e.name,e.value))),t.appendChild(document.createTextNode(o)),e.parentNode.replaceChild(t,e)})),GLOBAL_CONFIG.islazyload&&window.lazyLoadInstance.update(),"function"==typeof chatBtnFn&&chatBtnFn(),"function"==typeof panguInit&&panguInit(),"function"==typeof gtag&&gtag("config","",{page_path:window.location.pathname}),"object"==typeof _hmt&&_hmt.push(["_trackPageview",window.location.pathname]),"function"==typeof loadMeting&&document.getElementsByClassName("aplayer").length&&loadMeting(),"object"==typeof Prism&&Prism.highlightAll(),"object"==typeof preloader&&preloader.endLoading()})),document.addEventListener("pjax:error",(e=>{404===e.request.status&&pjax.loadUrl("/404.html")}))</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script data-pjax>if(document.getElementById("recent-posts")&&"/"===location.pathname){var parent=document.getElementById("recent-posts"),child='<div class="recent-post-item" style="width:100%;height: auto"><div id="catalog_magnet"><div class="magnet_item"><a class="magnet_link" href="https://www.hgez6.top/categories/嵌入式/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">📚 小白瞎搞 (3)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://www.hgez6.top/categories/学习记录/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">🎮 持续学习！ (5)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://www.hgez6.top/categories/开源/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">🐱‍👓 开放源码咯 (9)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://www.hgez6.top/categories/高等数学/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">📒 数学永远的神 (6)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><a class="magnet_link_more"  href="https://www.hgez6.top/categories/" style="flex:1;text-align: center;margin-bottom: 10px;">查看更多...</a></div></div>';console.log("已挂载magnet"),parent.insertAdjacentHTML("afterbegin",child)}</script><style>#catalog_magnet{flex-wrap:wrap;display:flex;width:100%;justify-content:space-between;padding:10px 10px 0 10px;align-content:flex-start}.magnet_item{flex-basis:calc(50% - 5px);background:#e9e9e9;margin-bottom:10px;border-radius:8px;transition:all .2s ease-in-out}.magnet_item:hover{background:var(--text-bg-hover)}.magnet_link_more{color:#555}.magnet_link{color:#000}.magnet_link:hover{color:#fff}@media screen and (max-width:600px){.magnet_item{flex-basis:100%}}.magnet_link_context{display:flex;padding:10px;font-size:16px;transition:all .2s ease-in-out}.magnet_link_context:hover{padding:10px 20px}</style><style></style><script data-pjax>function butterfly_swiper_injector_config(){var i=document.getElementById("recent-posts");console.log("已挂载butterfly_swiper"),i.insertAdjacentHTML("afterbegin",'<div class="recent-post-item" style="height: auto;width: 100%"><div class="blog-slider swiper-container-fade swiper-container-horizontal" id="swiper_container"><div class="blog-slider__wrp swiper-wrapper" style="transition-duration: 0ms;"><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/65d9a22/&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://picsum.photos/id/635/300/300" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2023-03-21</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/65d9a22/&quot;);" href="javascript:void(0);" alt="">别忘了早上涂疤痕灵戴帽子！</a><div class="blog-slider__text">别忘了早上涂疤痕灵戴帽子</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/65d9a22/&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/15a6564e/&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://picsum.photos/id/432/5000/3333" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2022-01-02</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/15a6564e/&quot;);" href="javascript:void(0);" alt="">TCP局域网内点对点控制方案</a><div class="blog-slider__text">再怎么看我也不知道怎么描述它的啦！</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/15a6564e/&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/63350/&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://picsum.photos/id/430/5000/3333" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2022-01-01</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/63350/&quot;);" href="javascript:void(0);" alt="">一种轻量化云端闭环设备间协同算法设计</a><div class="blog-slider__text">再怎么看我也不知道怎么描述它的啦！</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/63350/&quot;);" href="javascript:void(0);" alt="">详情       </a></div></div></div><div class="blog-slider__pagination swiper-pagination-clickable swiper-pagination-bullets"></div></div></div>')}for(var elist="undefined".split(","),cpage=location.pathname,epage="/",flag=0,i=0;i<elist.length;i++)cpage.includes(elist[i])&&flag++;("all"===epage&&0==flag||epage===cpage)&&butterfly_swiper_injector_config()</script><script defer src="/js/chajian/swiper.min.js"></script><script defer data-pjax src="/js/chajian/swiper_init.js"></script><div class="js-pjax"><script async>for(var arr=document.getElementsByClassName("recent-post-item"),i=0;i<arr.length;i++)arr[i].classList.add("wow"),arr[i].classList.add("animate__zoomIn"),arr[i].setAttribute("data-wow-duration","2s"),arr[i].setAttribute("data-wow-delay","200ms"),arr[i].setAttribute("data-wow-offset","30"),arr[i].setAttribute("data-wow-iteration","1")</script><script async>for(var arr=document.getElementsByClassName("card-widget"),i=0;i<arr.length;i++)arr[i].classList.add("wow"),arr[i].classList.add("animate__zoomIn"),arr[i].setAttribute("data-wow-duration","2s"),arr[i].setAttribute("data-wow-delay","200ms"),arr[i].setAttribute("data-wow-offset","30"),arr[i].setAttribute("data-wow-iteration","1")</script></div><script defer src="/js/chajian/wow.min.js"></script><script defer src="/js/chajian/wow_init.js"></script><script data-pjax src="https://npm.elemecdn.com/hexo-filter-gitcalendar/lib/gitcalendar.js"></script><script data-pjax>function gitcalendar_injector_config(){document.getElementById("recent-posts").insertAdjacentHTML("afterbegin",'<div class="recent-post-item" id="gitcalendarBar" style="width:100%;height:auto;padding:10px;"><style>#git_container{min-height: 320px}@media screen and (max-width:650px) {#git_container{min-height: 0px}}</style><div id="git_loading" style="width:10%;height:100%;margin:0 auto;display: block;"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 50 50" style="enable-background:new 0 0 50 50" xml:space="preserve"><path fill="#d0d0d0" d="M25.251,6.461c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615V6.461z" transform="rotate(275.098 25 25)"><animatetransform attributeType="xml" attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="0.6s" repeatCount="indefinite"></animatetransform></path></svg><style>#git_container{display: none;}</style></div><div id="git_container"></div></div>'),console.log("已挂载gitcalendar")}document.getElementById("recent-posts")&&"/"===location.pathname&&(gitcalendar_injector_config(),GitCalendarInit("https://gitapi.hgez6.top/api?hgez6",["#d9e0df","#c6e0dc","#a8dcd4","#9adcd2","#89ded1","#77e0d0","#5fdecb","#47dcc6","#39dcc3","#1fdabe","#00dab9"],"hgez6"))</script><script async src="//at.alicdn.com/t/font_2032782_8d5kxvn09md.js"></script></body></html>